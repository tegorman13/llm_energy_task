<!DOCTYPE html><html lang="en"><head><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Electricity-Use Communications Study</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Dark mode support */
        :root {
            --primary-color: #5D5CDE;
            --bg-color: #FFFFFF;
            --text-color: #333333;
            --card-bg: #F8F8F8;
            --border-color: #DDDDDD;
        }
        
        .dark {
            --primary-color: #7E7DFF;
            --bg-color: #181818;
            --text-color: #E0E0E0;
            --card-bg: #282828;
            --border-color: #444444;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }
        
        .card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-color);
            opacity: 0.9;
        }
        
        .graph-legend-item {
            display: flex;
            align-items: center;
            margin-right: 16px;
        }
        
        .graph-legend-color {
            width: 12px;
            height: 12px;
            margin-right: 4px;
        }
        
        table td, table th {
            border: 1px solid var(--border-color);
            padding: 8px;
        }
        
        /* For icon graphs */
        .icon-chart {
            display: flex;
            flex-direction: column;
        }
        
        .icon-row {
            display: flex;
            margin-bottom: 8px;
            align-items: center;
        }
        
        .icon-label {
            width: 100px;
            text-align: right;
            margin-right: 10px;
        }
        
        .icon-bar {
            display: flex;
            align-items: center;
        }
        
        .icon {
            width: 16px;
            height: 16px;
            margin-right: 2px;
            background-color: var(--primary-color);
            border-radius: 3px;
        }
        
        .house-icon {
            fill: var(--primary-color);
            margin-right: 2px;
            width: 16px;
            height: 16px;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Progress bar */
        .progress-container {
            width: 100%;
            height: 8px;
            background-color: var(--border-color);
            border-radius: 4px;
            margin-bottom: 16px;
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 4px;
            transition: width 0.3s;
        }
        
        /* True/False buttons */
        .tf-button {
            border: 2px solid var(--border-color);
            background-color: transparent;
            padding: 8px 16px;
            border-radius: 4px;
            margin-right: 8px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .tf-button.selected {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        /* Likert scale */
        .likert-scale {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
        }
        
        .likert-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--border-color);
            background-color: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .likert-btn.selected {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .likert-scale-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
        }
        
        .stacked-bar-chart {
            position: relative;
            width: 100%;
            height: 300px;
        }
        
        .stacked-bar {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 30px;
            margin-right: 15px;
        }
        
        .stacked-bar-section {
            width: 100%;
        }
        
        /* For the energy literacy questions */
        .question-card {
            margin-bottom: 24px;
            padding: 16px;
            border-radius: 8px;
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
        }
        
        .option-btn {
            display: block;
            width: 100%;
            text-align: left;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            background-color: transparent;
            transition: all 0.3s;
        }
        
        .option-btn.selected {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
    </style>
</head>
<body class="font-sans">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Progress bar -->
        <div class="progress-container" id="progressContainer">
            <div class="progress-bar" id="progressBar" style="width: 0%"></div>
        </div>
        
        <!-- Main content area -->
        <div id="appContainer">
            <!-- Content will be dynamically inserted here -->
        </div>
    </div>

    <script>
        // Check for dark mode preference
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
        
        // Main application logic
        const app = {
            currentSection: 'intro',
            format: null, // 'table', 'bar', or 'icon'
            progress: 0,
            responses: {
                understanding: {
                    historical: [],
                    neighbor: [],
                    appliance: []
                },
                preferences: {
                    historical: [],
                    neighbor: [],
                    appliance: []
                },
                intentions: {
                    historical: null,
                    neighbor: null,
                    appliance: null
                },
                energyLiteracy: []
            },
            
            // Data for the Smith family electricity use
            data: {
                historical: [
                    {month: 'Jan 2011', usage: 1650},
                    {month: 'Feb 2011', usage: 1500},
                    {month: 'Mar 2011', usage: 1100},
                    {month: 'Apr 2011', usage: 900},
                    {month: 'May 2011', usage: 1000},
                    {month: 'Jun 2011', usage: 1400},
                    {month: 'Jul 2011', usage: 1700},
                    {month: 'Aug 2011', usage: 1800},
                    {month: 'Sep 2011', usage: 1200},
                    {month: 'Oct 2011', usage: 1000},
                    {month: 'Nov 2011', usage: 1300},
                    {month: 'Dec 2011', usage: 1600},
                    {month: 'Jan 2012', usage: 1700},
                    {month: 'Feb 2012', usage: 1300}
                ],
                neighbors: [
                    {range: '0-300', count: 3},
                    {range: '301-600', count: 15},
                    {range: '601-900', count: 25},
                    {range: '901-1200', count: 8},
                    {range: '1201-1500', count: 3},
                    {range: 'Smith Home', count: 1700}
                ],
                appliance: [
                    {month: 'Jan 2011', central_ac: 0, space_heating: 800, lighting: 200, kitchen: 300, other: 350},
                    {month: 'Feb 2011', central_ac: 0, space_heating: 700, lighting: 200, kitchen: 250, other: 350},
                    {month: 'Mar 2011', central_ac: 0, space_heating: 350, lighting: 150, kitchen: 250, other: 350},
                    {month: 'Apr 2011', central_ac: 0, space_heating: 200, lighting: 100, kitchen: 250, other: 350},
                    {month: 'May 2011', central_ac: 0, space_heating: 100, lighting: 100, kitchen: 200, other: 600},
                    {month: 'Jun 2011', central_ac: 550, space_heating: 0, lighting: 100, kitchen: 400, other: 350},
                    {month: 'Jul 2011', central_ac: 850, space_heating: 0, lighting: 100, kitchen: 400, other: 350},
                    {month: 'Aug 2011', central_ac: 950, space_heating: 0, lighting: 100, kitchen: 400, other: 350},
                    {month: 'Sep 2011', central_ac: 450, space_heating: 0, lighting: 100, kitchen: 300, other: 350},
                    {month: 'Oct 2011', central_ac: 0, space_heating: 250, lighting: 100, kitchen: 300, other: 350},
                    {month: 'Nov 2011', central_ac: 0, space_heating: 550, lighting: 100, kitchen: 300, other: 350},
                    {month: 'Dec 2011', central_ac: 0, space_heating: 750, lighting: 150, kitchen: 350, other: 350},
                    {month: 'Jan 2012', central_ac: 0, space_heating: 850, lighting: 200, kitchen: 300, other: 350},
                    {month: 'Feb 2012', central_ac: 0, space_heating: 550, lighting: 150, kitchen: 250, other: 350}
                ]
            },
            
            // Questions for measuring understanding
            questions: {
                understanding: {
                    historical: [
                        {text: 'The highest electricity use was 1800kWh.', answer: true, type: 'verbatim'},
                        {text: 'The lowest electricity use was 700kWh.', answer: false, type: 'verbatim'},
                        {text: 'Just looking at the winter months (Dec, Jan, Feb), the Smiths tend to use the most on electricity in February.', answer: false, type: 'complex'},
                        {text: 'The Smith\'s home used more electricity in February 2011 than February 2012.', answer: true, type: 'complex'},
                        {text: 'The Smith\'s home used the most electricity in August.', answer: true, type: 'complex'},
                        {text: 'The Smith\'s home used the most electricity in the summer months (Jun, Jul, Aug).', answer: true, type: 'complex'},
                        {text: 'Every month, the Smith\'s electricity use was above 600kWh.', answer: true, type: 'verbatim'}
                    ],
                    neighbor: [
                        {text: 'The Smith\'s neighbors vary in how much electricity they use.', answer: true, type: 'complex'},
                        {text: '18 homes used less electricity than the Smith\'s home.', answer: false, type: 'complex'},
                        {text: 'The Smith\'s home used more electricity than most of their neighbors.', answer: true, type: 'complex'},
                        {text: 'The Smith\'s home should use less electricity to be closer to the neighborhood average.', answer: true, type: 'complex'},
                        {text: 'Most homes used more than 300kWh of electricity.', answer: true, type: 'verbatim'},
                        {text: 'There is a difference of about 696kWh between the home that used the most and the least electricity.', answer: false, type: 'verbatim'},
                        {text: 'The maximum amount of electricity used by the Smith\'s neighbors was about 279kWh.', answer: false, type: 'verbatim'}
                    ],
                    appliance: [
                        {text: 'In January 2011, the Smiths used the most electricity for space heating.', answer: true, type: 'complex'},
                        {text: 'In May 2011, the Smiths used the most electricity for running their "other" appliances.', answer: true, type: 'complex'},
                        {text: 'The Smith\'s home used less electricity in January 2011 than in January 2012.', answer: true, type: 'complex'},
                        {text: 'The Smith\'s use 300-400kWh of electricity a month for "other" appliances.', answer: true, type: 'verbatim'},
                        {text: 'The difference in usage for lighting and kitchen appliances is never more than 100kWh.', answer: false, type: 'verbatim'},
                        {text: 'The main reason why the Smith\'s electricity use changes from month-to-month is because of lighting.', answer: false, type: 'complex'},
                        {text: 'Without heat or air-conditioning, the Smiths would probably use between 400-500kWh per month.', answer: false, type: 'verbatim'}
                    ]
                },
                preferences: [
                    {text: 'How clear is this information?', scale: '1=not at all to 7=very much'},
                    {text: 'How easy is this information to understand?', scale: '1=not at all to 7=very much'},
                    {text: 'How much do you like the way this information was presented?', scale: '1=not at all to 7=very much'},
                    {text: 'How easy is this information to use?', scale: '1=not at all to 7=very much'},
                    {text: 'How much would you like it if this information were included in your electricity bill?', scale: '1=not at all to 7=very much'},
                    {text: 'How useful would it be if this information came with your electricity bill?', scale: '1=not at all to 7=very much'},
                    {text: 'How professional does this information seem?', scale: '1=not at all to 7=very much'},
                    {text: 'How much would you trust this information if it came with your electricity bill?', scale: '1=not at all to 7=very much'},
                    {text: 'How much more detail would you like to see if this information came with your electricity bill?', scale: '1=not at all to 7=a lot'},
                    {text: 'How much would this information help you decide how to change your electricity use?', scale: '1=not at all to 7=a lot'}
                ],
                intentions: {
                    text: 'How much does this information make you want to lower your electricity usage?',
                    scale: '1=not at all to 7=a lot'
                },
                energyLiteracy: [
                    {
                        text: 'The amount of ELECTRICAL ENERGY (ELECTRICITY) we use is measured in units called...',
                        options: ['Kilowatt (kW)', 'Kilowatt-hours (kWh)', 'British Thermal Units (BTU)', 'Volts (V)', 'Horsepower (HP)'],
                        answer: 1
                    },
                    {
                        text: 'The amount of ENERGY consumed by an electrical appliance is equal to the power rating of the appliance (watts or kilowatts)...',
                        options: ['Multiplied by the cost of electricity', 'Added to the cost of electricity', 'Multiplied by the time it\'s used', 'Divided by the time it\'s used', 'Added to the time it\'s used'],
                        answer: 2
                    },
                    {
                        text: 'When you turn on an incandescent light bulb, which of the following energy conversion takes place?',
                        options: ['Electrical energy to radient energy (light)', 'Chemical energy to radient energy (light)', 'Electrical energy to radient energy (light) and thermal energy (heat)', 'Chemical energy to radient energy (light) and thermal energy (heat)', 'Electrical energy to radient energy (light) and mechanical energy'],
                        answer: 2
                    },
                    {
                        text: 'The best reason to buy an ENERGY STARÂ® appliance is...',
                        options: ['ENERGY STAR appliances are usually bigger', 'ENERGY STAR appliances cost more', 'ENERGY STAR appliances use less energy', 'ENERGY STAR appliances are more modern looking', 'ENERGY STAR appliances cost less'],
                        answer: 2
                    },
                    {
                        text: 'Which uses the MOST ENERGY in the average American home in one year?',
                        options: ['Refrigerating food and beverages', 'Washing and drying clothing', 'Heating and cooling rooms', 'Heating and cooling water', 'Lighting the home'],
                        answer: 2
                    },
                    {
                        text: 'Which of the following items uses the MOST ELECTRICITY in the average home in one year?',
                        options: ['Lights', 'Refrigerator', 'Telephone', 'Television', 'Computer'],
                        answer: 1
                    },
                    {
                        text: 'Which of the following sources provides most of the ELECTRICITY in the United States?',
                        options: ['Nuclear power', 'Burning petroleum', 'Burning coal', 'Solar energy', 'Water (hydro) power'],
                        answer: 2
                    },
                    {
                        text: 'Some people think that if we run out of fossil fuels we can just switch over to electric cars. What is wrong with this idea?',
                        options: ['Most electricity is currently produced from fossil fuels (coal, oil, natural gas)', 'Switching to electric cars will make unemployment rates go up', 'It has been proven that it is impossible to build electric cars in great quantities', 'You can\'t use electricity to operate a car', 'There is nothing wrong with this idea'],
                        answer: 0
                    }
                ]
            },
            
            // Study results for comparison at the end
            studyResults: {
                understanding: {
                    table: {
                        historical: 0.84,
                        neighbor: 0.75,
                        appliance: 0.73
                    },
                    bar: {
                        historical: 0.73,
                        neighbor: 0.49,
                        appliance: 0.64
                    },
                    icon: {
                        historical: 0.77,
                        neighbor: 0.75,
                        appliance: 0.61
                    }
                },
                preferences: {
                    table: {
                        historical: 5.67,
                        neighbor: 4.80,
                        appliance: 5.41
                    },
                    bar: {
                        historical: 5.72,
                        neighbor: 4.09,
                        appliance: 5.41
                    },
                    icon: {
                        historical: 5.85,
                        neighbor: 4.26,
                        appliance: 4.97
                    }
                },
                intentions: {
                    historical: 5.71,
                    neighbor: 4.83,
                    appliance: 5.42
                }
            },
            
            // Initialize the application
            init() {
                this.showSection('intro');
                this.updateProgressBar();
            },
            
            // Update the progress bar
            updateProgressBar() {
                document.getElementById('progressBar').style.width = `${this.progress}%`;
            },
            
            // Show a specific section of the app
            showSection(section) {
                this.currentSection = section;
                const container = document.getElementById('appContainer');
                
                switch(section) {
                    case 'intro':
                        container.innerHTML = this.renderIntro();
                        break;
                    case 'historical-info':
                        container.innerHTML = this.renderHistoricalInfo();
                        break;
                    case 'historical-questions':
                        container.innerHTML = this.renderHistoricalQuestions();
                        break;
                    case 'neighbor-info':
                        container.innerHTML = this.renderNeighborInfo();
                        break;
                    case 'neighbor-questions':
                        container.innerHTML = this.renderNeighborQuestions();
                        break;
                    case 'appliance-info':
                        container.innerHTML = this.renderApplianceInfo();
                        break;
                    case 'appliance-questions':
                        container.innerHTML = this.renderApplianceQuestions();
                        break;
                    case 'energy-literacy':
                        container.innerHTML = this.renderEnergyLiteracy();
                        break;
                    case 'results':
                        container.innerHTML = this.renderResults();
                        break;
                    default:
                        container.innerHTML = '<p>Unknown section</p>';
                }
                
                // Initialize any charts or special elements
                if (section === 'historical-info' && this.format === 'bar') {
                    this.initHistoricalBarChart();
                }
                if (section === 'historical-info' && this.format === 'icon') {
                    this.initHistoricalIconChart();
                }
                if (section === 'neighbor-info' && this.format === 'bar') {
                    this.initNeighborBarChart();
                }
                if (section === 'neighbor-info' && this.format === 'icon') {
                    this.initNeighborIconChart();
                }
                if (section === 'appliance-info' && this.format === 'bar') {
                    this.initApplianceBarChart();
                }
                if (section === 'appliance-info' && this.format === 'icon') {
                    this.initApplianceIconChart();
                }
                if (section === 'results') {
                    this.initResultsCharts();
                }
            },
            
            // Render the introduction screen
            renderIntro() {
                return `
                    <div class="card p-6 rounded-lg shadow-md">
                        <h1 class="text-2xl font-bold mb-4">Electricity-Use Communications Study</h1>
                        <p class="mb-4">
                            Welcome to this demo based on the research study "Perceptions of electricity-use communications: effects of information, format, and individual differences" by Canfield et al. (2017).
                        </p>
                        <p class="mb-4">
                            In this study, you'll view information about a fictional household's electricity use presented in different formats, then answer questions about what you've seen.
                        </p>
                        <p class="mb-4">
                            You'll be randomly assigned to see the information in one of three formats:
                            <ul class="list-disc ml-8 my-2">
                                <li>Tables</li>
                                <li>Bar Graphs</li>
                                <li>Icon Graphs</li>
                            </ul>
                        </p>
                        <p class="mb-4">
                            After completing all the activities, you'll see how your responses compare to the findings from the original study.
                        </p>
                        <button id="startBtn" class="btn-primary px-6 py-2 rounded-lg mt-4">Start Study</button>
                    </div>
                `;
            },
            
            // Render the historical information
            renderHistoricalInfo() {
                let content = `
                    <div class="card p-6 rounded-lg shadow-md">
                        <h1 class="text-2xl font-bold mb-4">Historical Electricity Use</h1>
                        <p class="mb-4">
                            Below is information about the Smith family's historical electricity use from January 2011 to February 2012.
                        </p>
                `;
                
                // Add the appropriate visualization based on format
                if (this.format === 'table') {
                    content += `
                        <div class="overflow-x-auto">
                            <table class="w-full border-collapse">
                                <thead>
                                    <tr>
                                        <th class="text-left p-2">Month</th>
                                        <th class="text-left p-2">Electricity Use (kWh)</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    this.data.historical.forEach(item => {
                        content += `
                            <tr>
                                <td class="p-2">${item.month}</td>
                                <td class="p-2">${item.usage}</td>
                            </tr>
                        `;
                    });
                    
                    content += `
                                </tbody>
                            </table>
                        </div>
                    `;
                } else if (this.format === 'bar') {
                    content += `
                        <div class="h-64 mb-4">
                            <canvas id="historicalBarChart"></canvas>
                        </div>
                    `;
                } else if (this.format === 'icon') {
                    content += `
                        <div id="historicalIconChart" class="icon-chart mb-4">
                            <!-- Icon chart will be rendered here -->
                        </div>
                    `;
                }
                
                content += `
                        <button id="historicalNextBtn" class="btn-primary px-6 py-2 rounded-lg mt-4">Continue</button>
                    </div>
                `;
                
                return content;
            },
            
            // Render the historical questions
            renderHistoricalQuestions() {
                let content = `
                    <div class="card p-6 rounded-lg shadow-md">
                        <h1 class="text-2xl font-bold mb-4">Understanding Historical Use</h1>
                        <p class="mb-4">
                            Based on the historical electricity use information you just saw, please answer the following questions:
                        </p>
                        
                        <div class="mb-6">
                            <h2 class="text-xl font-bold mb-2">True/False Questions</h2>
                `;
                
                this.questions.understanding.historical.forEach((question, index) => {
                    content += `
                        <div class="mb-4">
                            <p class="mb-2">${index + 1}. ${question.text}</p>
                            <div>
                                <button class="tf-button" data-question="${index}" data-answer="true">True</button>
                                <button class="tf-button" data-question="${index}" data-answer="false">False</button>
                            </div>
                        </div>
                    `;
                });
                
                content += `
                        </div>
                        
                        <div class="mb-6">
                            <h2 class="text-xl font-bold mb-2">Preference Questions</h2>
                `;
                
                this.questions.preferences.forEach((question, index) => {
                    content += `
                        <div class="mb-4">
                            <p class="mb-2">${index + 1}. ${question.text}</p>
                            <div class="likert-scale">
                                ${[1, 2, 3, 4, 5, 6, 7].map(num => 
                                    `<button class="likert-btn" data-question="${index}" data-value="${num}">${num}</button>`
                                ).join('')}
                            </div>
                            <div class="likert-scale-labels">
                                <span>Not at all</span>
                                <span>Very much</span>
                            </div>
                        </div>
                    `;
                });
                
                content += `
                        </div>
                        
                        <div class="mb-6">
                            <h2 class="text-xl font-bold mb-2">Intention to Save Electricity</h2>
                            <p class="mb-2">${this.questions.intentions.text}</p>
                            <div class="likert-scale">
                                ${[1, 2, 3, 4, 5, 6, 7].map(num => 
                                    `<button class="likert-btn intention-btn" data-value="${num}">${num}</button>`
                                ).join('')}
                            </div>
                            <div class="likert-scale-labels">
                                <span>Not at all</span>
                                <span>A lot</span>
                            </div>
                        </div>
                        
                        <button id="historicalQuestionsNextBtn" class="btn-primary px-6 py-2 rounded-lg mt-4">Continue</button>
                    </div>
                `;
                
                return content;
            },
            
            // Render the neighbor information
            renderNeighborInfo() {
                let content = `
                    <div class="card p-6 rounded-lg shadow-md">
                        <h1 class="text-2xl font-bold mb-4">Neighbor Comparison</h1>
                        <p class="mb-4">
                            Below is information comparing the Smith family's electricity use to that of their neighbors.
                        </p>
                `;
                
                // Add the appropriate visualization based on format
                if (this.format === 'table') {
                    content += `
                        <div class="overflow-x-auto">
                            <table class="w-full border-collapse">
                                <thead>
                                    <tr>
                                        <th class="text-left p-2">Electricity Use Range (kWh)</th>
                                        <th class="text-left p-2">Number of Homes</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    this.data.neighbors.forEach(item => {
                        if (item.range === 'Smith Home') {
                            content += `
                                <tr>
                                    <td class="p-2">Smith Home</td>
                                    <td class="p-2">${item.count} kWh</td>
                                </tr>
                            `;
                        } else {
                            content += `
                                <tr>
                                    <td class="p-2">${item.range} kWh</td>
                                    <td class="p-2">${item.count}</td>
                                </tr>
                            `;
                        }
                    });
                    
                    content += `
                                </tbody>
                            </table>
                        </div>
                    `;
                } else if (this.format === 'bar') {
                    content += `
                        <div class="h-64 mb-4">
                            <canvas id="neighborBarChart"></canvas>
                        </div>
                    `;
                } else if (this.format === 'icon') {
                    content += `
                        <div id="neighborIconChart" class="mb-4">
                            <!-- Icon chart will be rendered here -->
                        </div>
                    `;
                }
                
                content += `
                        <button id="neighborNextBtn" class="btn-primary px-6 py-2 rounded-lg mt-4">Continue</button>
                    </div>
                `;
                
                return content;
            },
            
            // Render the neighbor questions
            renderNeighborQuestions() {
                let content = `
                    <div class="card p-6 rounded-lg shadow-md">
                        <h1 class="text-2xl font-bold mb-4">Understanding Neighbor Comparison</h1>
                        <p class="mb-4">
                            Based on the neighbor comparison information you just saw, please answer the following questions:
                        </p>
                        
                        <div class="mb-6">
                            <h2 class="text-xl font-bold mb-2">True/False Questions</h2>
                `;
                
                this.questions.understanding.neighbor.forEach((question, index) => {
                    content += `
                        <div class="mb-4">
                            <p class="mb-2">${index + 1}. ${question.text}</p>
                            <div>
                                <button class="tf-button" data-question="${index}" data-answer="true">True</button>
                                <button class="tf-button" data-question="${index}" data-answer="false">False</button>
                            </div>
                        </div>
                    `;
                });
                
                content += `
                        </div>
                        
                        <div class="mb-6">
                            <h2 class="text-xl font-bold mb-2">Preference Questions</h2>
                `;
                
                this.questions.preferences.forEach((question, index) => {
                    content += `
                        <div class="mb-4">
                            <p class="mb-2">${index + 1}. ${question.text}</p>
                            <div class="likert-scale">
                                ${[1, 2, 3, 4, 5, 6, 7].map(num => 
                                    `<button class="likert-btn" data-question="${index}" data-value="${num}">${num}</button>`
                                ).join('')}
                            </div>
                            <div class="likert-scale-labels">
                                <span>Not at all</span>
                                <span>Very much</span>
                            </div>
                        </div>
                    `;
                });
                
                content += `
                        </div>
                        
                        <div class="mb-6">
                            <h2 class="text-xl font-bold mb-2">Intention to Save Electricity</h2>
                            <p class="mb-2">${this.questions.intentions.text}</p>
                            <div class="likert-scale">
                                ${[1, 2, 3, 4, 5, 6, 7].map(num => 
                                    `<button class="likert-btn intention-btn" data-value="${num}">${num}</button>`
                                ).join('')}
                            </div>
                            <div class="likert-scale-labels">
                                <span>Not at all</span>
                                <span>A lot</span>
                            </div>
                        </div>
                        
                        <button id="neighborQuestionsNextBtn" class="btn-primary px-6 py-2 rounded-lg mt-4">Continue</button>
                    </div>
                `;
                
                return content;
            },
            
            // Render the appliance information
            renderApplianceInfo() {
                let content = `
                    <div class="card p-6 rounded-lg shadow-md">
                        <h1 class="text-2xl font-bold mb-4">Appliance Breakdown</h1>
                        <p class="mb-4">
                            Below is a breakdown of the Smith family's electricity use by appliance category.
                        </p>
                `;
                
                // Add the appropriate visualization based on format
                if (this.format === 'table') {
                    content += `
                        <div class="overflow-x-auto">
                            <table class="w-full border-collapse">
                                <thead>
                                    <tr>
                                        <th class="text-left p-2">Month</th>
                                        <th class="text-left p-2">Central A/C</th>
                                        <th class="text-left p-2">Space Heating</th>
                                        <th class="text-left p-2">Lighting</th>
                                        <th class="text-left p-2">Kitchen Appliances</th>
                                        <th class="text-left p-2">Other Appliances</th>
                                        <th class="text-left p-2">Total (kWh)</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    this.data.appliance.forEach(item => {
                        const total = item.central_ac + item.space_heating + item.lighting + item.kitchen + item.other;
                        content += `
                            <tr>
                                <td class="p-2">${item.month}</td>
                                <td class="p-2">${item.central_ac}</td>
                                <td class="p-2">${item.space_heating}</td>
                                <td class="p-2">${item.lighting}</td>
                                <td class="p-2">${item.kitchen}</td>
                                <td class="p-2">${item.other}</td>
                                <td class="p-2">${total}</td>
                            </tr>
                        `;
                    });
                    
                    content += `
                                </tbody>
                            </table>
                        </div>
                    `;
                } else if (this.format === 'bar') {
                    content += `
                        <div class="h-64 mb-4">
                            <canvas id="applianceBarChart"></canvas>
                        </div>
                        <div class="flex flex-wrap mb-4">
                            <div class="graph-legend-item">
                                <div class="graph-legend-color" style="background-color: #FF6384;"></div>
                                <span>Central A/C</span>
                            </div>
                            <div class="graph-legend-item">
                                <div class="graph-legend-color" style="background-color: #36A2EB;"></div>
                                <span>Space Heating</span>
                            </div>
                            <div class="graph-legend-item">
                                <div class="graph-legend-color" style="background-color: #FFCE56;"></div>
                                <span>Lighting</span>
                            </div>
                            <div class="graph-legend-item">
                                <div class="graph-legend-color" style="background-color: #4BC0C0;"></div>
                                <span>Kitchen</span>
                            </div>
                            <div class="graph-legend-item">
                                <div class="graph-legend-color" style="background-color: #9966FF;"></div>
                                <span>Other</span>
                            </div>
                        </div>
                    `;
                } else if (this.format === 'icon') {
                    content += `
                        <div id="applianceIconChart" class="mb-4">
                            <!-- Icon chart will be rendered here -->
                        </div>
                        <div class="flex flex-wrap mb-4">
                            <div class="graph-legend-item">
                                <div class="graph-legend-color" style="background-color: #FF6384;"></div>
                                <span>Central A/C</span>
                            </div>
                            <div class="graph-legend-item">
                                <div class="graph-legend-color" style="background-color: #36A2EB;"></div>
                                <span>Space Heating</span>
                            </div>
                            <div class="graph-legend-item">
                                <div class="graph-legend-color" style="background-color: #FFCE56;"></div>
                                <span>Lighting</span>
                            </div>
                            <div class="graph-legend-item">
                                <div class="graph-legend-color" style="background-color: #4BC0C0;"></div>
                                <span>Kitchen</span>
                            </div>
                            <div class="graph-legend-item">
                                <div class="graph-legend-color" style="background-color: #9966FF;"></div>
                                <span>Other</span>
                            </div>
                        </div>
                    `;
                }
                
                content += `
                        <button id="applianceNextBtn" class="btn-primary px-6 py-2 rounded-lg mt-4">Continue</button>
                    </div>
                `;
                
                return content;
            },
            
            // Render the appliance questions
            renderApplianceQuestions() {
                let content = `
                    <div class="card p-6 rounded-lg shadow-md">
                        <h1 class="text-2xl font-bold mb-4">Understanding Appliance Breakdown</h1>
                        <p class="mb-4">
                            Based on the appliance breakdown information you just saw, please answer the following questions:
                        </p>
                        
                        <div class="mb-6">
                            <h2 class="text-xl font-bold mb-2">True/False Questions</h2>
                `;
                
                this.questions.understanding.appliance.forEach((question, index) => {
                    content += `
                        <div class="mb-4">
                            <p class="mb-2">${index + 1}. ${question.text}</p>
                            <div>
                                <button class="tf-button" data-question="${index}" data-answer="true">True</button>
                                <button class="tf-button" data-question="${index}" data-answer="false">False</button>
                            </div>
                        </div>
                    `;
                });
                
                content += `
                        </div>
                        
                        <div class="mb-6">
                            <h2 class="text-xl font-bold mb-2">Preference Questions</h2>
                `;
                
                this.questions.preferences.forEach((question, index) => {
                    content += `
                        <div class="mb-4">
                            <p class="mb-2">${index + 1}. ${question.text}</p>
                            <div class="likert-scale">
                                ${[1, 2, 3, 4, 5, 6, 7].map(num => 
                                    `<button class="likert-btn" data-question="${index}" data-value="${num}">${num}</button>`
                                ).join('')}
                            </div>
                            <div class="likert-scale-labels">
                                <span>Not at all</span>
                                <span>Very much</span>
                            </div>
                        </div>
                    `;
                });
                
                content += `
                        </div>
                        
                        <div class="mb-6">
                            <h2 class="text-xl font-bold mb-2">Intention to Save Electricity</h2>
                            <p class="mb-2">${this.questions.intentions.text}</p>
                            <div class="likert-scale">
                                ${[1, 2, 3, 4, 5, 6, 7].map(num => 
                                    `<button class="likert-btn intention-btn" data-value="${num}">${num}</button>`
                                ).join('')}
                            </div>
                            <div class="likert-scale-labels">
                                <span>Not at all</span>
                                <span>A lot</span>
                            </div>
                        </div>
                        
                        <button id="applianceQuestionsNextBtn" class="btn-primary px-6 py-2 rounded-lg mt-4">Continue</button>
                    </div>
                `;
                
                return content;
            },
            
            // Render the energy literacy questions
            renderEnergyLiteracy() {
                let content = `
                    <div class="card p-6 rounded-lg shadow-md">
                        <h1 class="text-2xl font-bold mb-4">Energy Literacy Assessment</h1>
                        <p class="mb-4">
                            Please answer the following questions about energy use and electricity:
                        </p>
                `;
                
                this.questions.energyLiteracy.forEach((question, qIndex) => {
                    content += `
                        <div class="question-card">
                            <p class="mb-2 font-semibold">${qIndex + 1}. ${question.text}</p>
                            <div class="mt-2">
                    `;
                    
                    question.options.forEach((option, oIndex) => {
                        content += `
                            <button class="option-btn" data-question="${qIndex}" data-option="${oIndex}">${option}</button>
                        `;
                    });
                    
                    content += `
                            </div>
                        </div>
                    `;
                });
                
                content += `
                        <button id="energyLiteracyNextBtn" class="btn-primary px-6 py-2 rounded-lg mt-4">See Results</button>
                    </div>
                `;
                
                return content;
            },
            
            // Render the results
            renderResults() {
                // Calculate scores
                const historicalUnderstanding = this.responses.understanding.historical.filter(Boolean).length / 7;
                const neighborUnderstanding = this.responses.understanding.neighbor.filter(Boolean).length / 7;
                const applianceUnderstanding = this.responses.understanding.appliance.filter(Boolean).length / 7;
                
                const historicalPreference = this.calculateMean(this.responses.preferences.historical);
                const neighborPreference = this.calculateMean(this.responses.preferences.neighbor);
                const appliancePreference = this.calculateMean(this.responses.preferences.appliance);
                
                const energyLiteracyScore = this.responses.energyLiteracy.filter(Boolean).length / 8;
                
                const formatName = this.format === 'table' ? 'Table' : (this.format === 'bar' ? 'Bar Graph' : 'Icon Graph');
                
                let content = `
                    <div class="card p-6 rounded-lg shadow-md">
                        <h1 class="text-2xl font-bold mb-4">Your Results</h1>
                        <p class="mb-4">
                            Thank you for participating in this study! Below are your results compared to the findings from the original study.
                        </p>
                        
                        <h2 class="text-xl font-bold mb-2">Information Format</h2>
                        <p class="mb-4">You were assigned to the <strong>${formatName}</strong> format.</p>
                        
                        <h2 class="text-xl font-bold mb-2">Understanding Scores</h2>
                        <div class="mb-4">
                            <p>Your scores (proportion of correct answers):</p>
                            <ul class="list-disc ml-8 my-2">
                                <li>Historical Use: ${Math.round(historicalUnderstanding * 100)}%</li>
                                <li>Neighbor Comparison: ${Math.round(neighborUnderstanding * 100)}%</li>
                                <li>Appliance Breakdown: ${Math.round(applianceUnderstanding * 100)}%</li>
                            </ul>
                        </div>
                        
                        <div class="h-64 mb-4">
                            <canvas id="understandingChart"></canvas>
                        </div>
                        
                        <h2 class="text-xl font-bold mb-2">Preference Ratings</h2>
                        <div class="mb-4">
                            <p>Your average ratings (scale: 1-7):</p>
                            <ul class="list-disc ml-8 my-2">
                                <li>Historical Use: ${historicalPreference.toFixed(1)}</li>
                                <li>Neighbor Comparison: ${neighborPreference.toFixed(1)}</li>
                                <li>Appliance Breakdown: ${appliancePreference.toFixed(1)}</li>
                            </ul>
                        </div>
                        
                        <div class="h-64 mb-4">
                            <canvas id="preferencesChart"></canvas>
                        </div>
                        
                        <h2 class="text-xl font-bold mb-2">Intentions to Save Electricity</h2>
                        <div class="mb-4">
                            <p>Your ratings (scale: 1-7):</p>
                            <ul class="list-disc ml-8 my-2">
                                <li>Historical Use: ${this.responses.intentions.historical || 'Not answered'}</li>
                                <li>Neighbor Comparison: ${this.responses.intentions.neighbor || 'Not answered'}</li>
                                <li>Appliance Breakdown: ${this.responses.intentions.appliance || 'Not answered'}</li>
                            </ul>
                        </div>
                        
                        <div class="h-64 mb-4">
                            <canvas id="intentionsChart"></canvas>
                        </div>
                        
                        <h2 class="text-xl font-bold mb-2">Energy Literacy</h2>
                        <p class="mb-4">
                            Your energy literacy score: ${Math.round(energyLiteracyScore * 100)}% correct
                        </p>
                        
                        <h2 class="text-xl font-bold mt-6 mb-2">Key Findings from the Original Study</h2>
                        <div class="mb-4">
                            <ul class="list-disc ml-8 my-2">
                                <li>Tables were generally the easiest format for participants to understand across all information types.</li>
                                <li>Historical use information was preferred the most, followed by the appliance breakdown, and then neighbor comparison.</li>
                                <li>Intentions to save electricity were highest for historical use and appliance breakdown information.</li>
                                <li>Individuals with lower energy literacy understood all information less, regardless of format.</li>
                            </ul>
                        </div>
                        
                        <button id="restartBtn" class="btn-primary px-6 py-2 rounded-lg mt-4">Restart Study</button>
                    </div>
                `;
                
                return content;
            },
            
            // Calculate the mean of an array
            calculateMean(arr) {
                if (!arr.length) return 0;
                return arr.reduce((a, b) => a + b, 0) / arr.length;
            },
            
            // Initialize the historical bar chart
            initHistoricalBarChart() {
                const ctx = document.getElementById('historicalBarChart').getContext('2d');
                
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: this.data.historical.map(item => item.month),
                        datasets: [{
                            label: 'Electricity Use (kWh)',
                            data: this.data.historical.map(item => item.usage),
                            backgroundColor: 'rgba(93, 92, 222, 0.8)',
                            borderColor: 'rgba(93, 92, 222, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Electricity Use (kWh)'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Month'
                                }
                            }
                        },
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            },
            
            // Initialize the historical icon chart
            initHistoricalIconChart() {
                const container = document.getElementById('historicalIconChart');
                container.innerHTML = ''; // Clear existing content
                
                const maxValue = Math.max(...this.data.historical.map(item => item.usage));
                const scale = 50 / maxValue; // Scale factor for number of icons
                
                this.data.historical.forEach(item => {
                    const row = document.createElement('div');
                    row.className = 'icon-row';
                    
                    const label = document.createElement('div');
                    label.className = 'icon-label';
                    label.textContent = item.month;
                    row.appendChild(label);
                    
                    const iconBar = document.createElement('div');
                    iconBar.className = 'icon-bar';
                    
                    const numIcons = Math.round(item.usage * scale / 50);
                    for (let i = 0; i < numIcons; i++) {
                        const icon = document.createElement('div');
                        icon.className = 'icon';
                        iconBar.appendChild(icon);
                    }
                    
                    const valueLabel = document.createElement('span');
                    valueLabel.textContent = `${item.usage} kWh`;
                    valueLabel.className = 'ml-2';
                    iconBar.appendChild(valueLabel);
                    
                    row.appendChild(iconBar);
                    container.appendChild(row);
                });
            },
            
            // Initialize the neighbor bar chart
            initNeighborBarChart() {
                const ctx = document.getElementById('neighborBarChart').getContext('2d');
                
                // Prepare data (exclude Smith Home for histogram)
                const histogramData = this.data.neighbors.filter(item => item.range !== 'Smith Home');
                
                // Create the chart
                const chart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: histogramData.map(item => item.range),
                        datasets: [{
                            label: 'Number of Homes',
                            data: histogramData.map(item => item.count),
                            backgroundColor: 'rgba(93, 92, 222, 0.8)',
                            borderColor: 'rgba(93, 92, 222, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Number of Homes'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Electricity Use Range (kWh)'
                                }
                            }
                        },
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            annotation: {
                                annotations: {
                                    line1: {
                                        type: 'line',
                                        mode: 'vertical',
                                        scaleID: 'x',
                                        value: 'Smith Home',
                                        borderColor: 'red',
                                        borderWidth: 2,
                                        label: {
                                            content: 'Smith Home (1700 kWh)',
                                            enabled: true,
                                            position: 'top'
                                        }
                                    }
                                }
                            }
                        }
                    }
                });
                
                // Add annotation for Smith Home
                const canvas = ctx.canvas;
                const width = canvas.width;
                const height = canvas.height;
                
                ctx.save();
                ctx.strokeStyle = 'red';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(width * 0.95, 20);
                ctx.lineTo(width * 0.95, height - 30);
                ctx.stroke();
                
                ctx.fillStyle = 'red';
                ctx.font = '12px Arial';
                ctx.textAlign = 'right';
                ctx.fillText('Smith Home (1700 kWh)', width * 0.94, 15);
                ctx.restore();
            },
            
            // Initialize the neighbor icon chart
            initNeighborIconChart() {
                const container = document.getElementById('neighborIconChart');
                container.innerHTML = ''; // Clear existing content
                
                // Create a wrapper for the histogram
                const histogramWrapper = document.createElement('div');
                histogramWrapper.style.display = 'flex';
                histogramWrapper.style.alignItems = 'flex-end';
                histogramWrapper.style.height = '250px';
                histogramWrapper.style.marginBottom = '10px';
                histogramWrapper.style.position = 'relative';
                
                // X-axis labels container
                const xAxisLabels = document.createElement('div');
                xAxisLabels.style.display = 'flex';
                xAxisLabels.style.justifyContent = 'space-between';
                xAxisLabels.style.width = '100%';
                
                // Histogram data (exclude Smith Home for histogram)
                const histogramData = this.data.neighbors.filter(item => item.range !== 'Smith Home');
                
                // Create bars
                histogramData.forEach(item => {
                    const barContainer = document.createElement('div');
                    barContainer.style.display = 'flex';
                    barContainer.style.flexDirection = 'column';
                    barContainer.style.alignItems = 'center';
                    barContainer.style.flex = '1';
                    barContainer.style.margin = '0 5px';
                    
                    const bar = document.createElement('div');
                    bar.style.display = 'flex';
                    bar.style.flexDirection = 'column-reverse';
                    bar.style.width = '80%';
                    bar.style.height = `${item.count * 8}px`;
                    
                    // Add house icons
                    for (let i = 0; i < item.count; i++) {
                        const houseIcon = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                        houseIcon.setAttribute('class', 'house-icon');
                        houseIcon.setAttribute('viewBox', '0 0 24 24');
                        
                        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                        path.setAttribute('d', 'M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z');
                        
                        houseIcon.appendChild(path);
                        bar.appendChild(houseIcon);
                    }
                    
                    barContainer.appendChild(bar);
                    
                    const label = document.createElement('div');
                    label.textContent = item.range;
                    label.style.marginTop = '5px';
                    label.style.textAlign = 'center';
                    label.style.fontSize = '12px';
                    
                    xAxisLabels.appendChild(label);
                    
                    histogramWrapper.appendChild(barContainer);
                });
                
                // Add Smith Home indicator
                const smithIndicator = document.createElement('div');
                smithIndicator.style.position = 'absolute';
                smithIndicator.style.right = '5%';
                smithIndicator.style.height = '100%';
                smithIndicator.style.borderLeft = '2px dashed red';
                
                const smithLabel = document.createElement('div');
                smithLabel.textContent = 'Smith Home (1700 kWh)';
                smithLabel.style.position = 'absolute';
                smithLabel.style.top = '5px';
                smithLabel.style.right = '5%';
                smithLabel.style.transform = 'translateX(50%)';
                smithLabel.style.color = 'red';
                smithLabel.style.fontWeight = 'bold';
                
                histogramWrapper.appendChild(smithIndicator);
                histogramWrapper.appendChild(smithLabel);
                
                // Y-axis label
                const yAxisLabel = document.createElement('div');
                yAxisLabel.textContent = 'Number of Homes';
                yAxisLabel.style.position = 'absolute';
                yAxisLabel.style.left = '-40px';
                yAxisLabel.style.top = '50%';
                yAxisLabel.style.transform = 'rotate(-90deg) translateX(-50%)';
                yAxisLabel.style.transformOrigin = 'left center';
                
                // X-axis label
                const xAxisLabel = document.createElement('div');
                xAxisLabel.textContent = 'Electricity Use Range (kWh)';
                xAxisLabel.style.textAlign = 'center';
                xAxisLabel.style.marginTop = '10px';
                
                container.appendChild(histogramWrapper);
                container.appendChild(xAxisLabels);
                container.appendChild(xAxisLabel);
            },
            
            // Initialize the appliance bar chart
            initApplianceBarChart() {
                const ctx = document.getElementById('applianceBarChart').getContext('2d');
                
                // Prepare data
                const labels = this.data.appliance.map(item => item.month);
                const datasets = [
                    {
                        label: 'Central A/C',
                        data: this.data.appliance.map(item => item.central_ac),
                        backgroundColor: 'rgba(255, 99, 132, 0.8)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Space Heating',
                        data: this.data.appliance.map(item => item.space_heating),
                        backgroundColor: 'rgba(54, 162, 235, 0.8)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Lighting',
                        data: this.data.appliance.map(item => item.lighting),
                        backgroundColor: 'rgba(255, 206, 86, 0.8)',
                        borderColor: 'rgba(255, 206, 86, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Kitchen Appliances',
                        data: this.data.appliance.map(item => item.kitchen),
                        backgroundColor: 'rgba(75, 192, 192, 0.8)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Other Appliances',
                        data: this.data.appliance.map(item => item.other),
                        backgroundColor: 'rgba(153, 102, 255, 0.8)',
                        borderColor: 'rgba(153, 102, 255, 1)',
                        borderWidth: 1
                    }
                ];
                
                // Create the chart
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: datasets
                    },
                    options: {
                        scales: {
                            x: {
                                stacked: true,
                                title: {
                                    display: true,
                                    text: 'Month'
                                }
                            },
                            y: {
                                stacked: true,
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Electricity Use (kWh)'
                                }
                            }
                        },
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            },
            
            // Initialize the appliance icon chart
            initApplianceIconChart() {
                const container = document.getElementById('applianceIconChart');
                container.innerHTML = ''; // Clear existing content
                
                // Create a stacked bar chart with icons
                const wrapper = document.createElement('div');
                wrapper.style.display = 'flex';
                wrapper.style.height = '300px';
                wrapper.style.alignItems = 'flex-end';
                wrapper.style.marginBottom = '20px';
                
                // Define colors for the categories
                const colors = {
                    central_ac: '#FF6384',
                    space_heating: '#36A2EB',
                    lighting: '#FFCE56',
                    kitchen: '#4BC0C0',
                    other: '#9966FF'
                };
                
                // X-axis labels container
                const xAxisLabels = document.createElement('div');
                xAxisLabels.style.display = 'flex';
                xAxisLabels.style.justifyContent = 'space-between';
                xAxisLabels.style.width = '100%';
                
                // Create stacked bars
                this.data.appliance.forEach(item => {
                    const barContainer = document.createElement('div');
                    barContainer.style.display = 'flex';
                    barContainer.style.flexDirection = 'column';
                    barContainer.style.alignItems = 'center';
                    barContainer.style.flex = '1';
                    barContainer.style.margin = '0 2px';
                    
                    const total = item.central_ac + item.space_heating + item.lighting + item.kitchen + item.other;
                    
                    // Create a stacked bar
                    const bar = document.createElement('div');
                    bar.className = 'stacked-bar';
                    
                    // Add each category
                    const addSection = (value, color, name) => {
                        if (value > 0) {
                            const section = document.createElement('div');
                            section.className = 'stacked-bar-section';
                            section.style.backgroundColor = color;
                            section.style.height = `${(value / total) * 100}%`;
                            section.title = `${name}: ${value} kWh`;
                            bar.appendChild(section);
                        }
                    };
                    
                    addSection(item.central_ac, colors.central_ac, 'Central A/C');
                    addSection(item.space_heating, colors.space_heating, 'Space Heating');
                    addSection(item.lighting, colors.lighting, 'Lighting');
                    addSection(item.kitchen, colors.kitchen, 'Kitchen Appliances');
                    addSection(item.other, colors.other, 'Other Appliances');
                    
                    barContainer.appendChild(bar);
                    
                    // Add label
                    const label = document.createElement('div');
                    label.textContent = item.month;
                    label.style.marginTop = '5px';
                    label.style.fontSize = '10px';
                    label.style.transform = 'rotate(-45deg)';
                    
                    barContainer.appendChild(label);
                    
                    wrapper.appendChild(barContainer);
                });
                
                // Y-axis label
                const yAxisLabel = document.createElement('div');
                yAxisLabel.textContent = 'Electricity Use (kWh)';
                yAxisLabel.style.position = 'absolute';
                yAxisLabel.style.left = '-40px';
                yAxisLabel.style.top = '50%';
                yAxisLabel.style.transform = 'rotate(-90deg) translateX(-50%)';
                yAxisLabel.style.transformOrigin = 'left center';
                
                container.appendChild(wrapper);
            },
            
            // Initialize the charts on the results page
            initResultsCharts() {
                // Understanding chart
                const understandingCtx = document.getElementById('understandingChart').getContext('2d');
                
                // Calculate understanding scores
                const historicalUnderstanding = this.responses.understanding.historical.filter(Boolean).length / 7;
                const neighborUnderstanding = this.responses.understanding.neighbor.filter(Boolean).length / 7;
                const applianceUnderstanding = this.responses.understanding.appliance.filter(Boolean).length / 7;
                
                const formatIndex = this.format === 'table' ? 'table' : (this.format === 'bar' ? 'bar' : 'icon');
                
                new Chart(understandingCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Historical Use', 'Neighbor Comparison', 'Appliance Breakdown'],
                        datasets: [
                            {
                                label: 'Your Score',
                                data: [historicalUnderstanding, neighborUnderstanding, applianceUnderstanding],
                                backgroundColor: 'rgba(93, 92, 222, 0.8)',
                                borderColor: 'rgba(93, 92, 222, 1)',
                                borderWidth: 1
                            },
                            {
                                label: 'Study Average',
                                data: [
                                    this.studyResults.understanding[formatIndex].historical,
                                    this.studyResults.understanding[formatIndex].neighbor,
                                    this.studyResults.understanding[formatIndex].appliance
                                ],
                                backgroundColor: 'rgba(153, 102, 255, 0.8)',
                                borderColor: 'rgba(153, 102, 255, 1)',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 1,
                                title: {
                                    display: true,
                                    text: 'Proportion Correct'
                                }
                            }
                        },
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
                
                // Preferences chart
                const preferencesCtx = document.getElementById('preferencesChart').getContext('2d');
                
                // Calculate preference scores
                const historicalPreference = this.calculateMean(this.responses.preferences.historical);
                const neighborPreference = this.calculateMean(this.responses.preferences.neighbor);
                const appliancePreference = this.calculateMean(this.responses.preferences.appliance);
                
                new Chart(preferencesCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Historical Use', 'Neighbor Comparison', 'Appliance Breakdown'],
                        datasets: [
                            {
                                label: 'Your Rating',
                                data: [historicalPreference, neighborPreference, appliancePreference],
                                backgroundColor: 'rgba(93, 92, 222, 0.8)',
                                borderColor: 'rgba(93, 92, 222, 1)',
                                borderWidth: 1
                            },
                            {
                                label: 'Study Average',
                                data: [
                                    this.studyResults.preferences[formatIndex].historical,
                                    this.studyResults.preferences[formatIndex].neighbor,
                                    this.studyResults.preferences[formatIndex].appliance
                                ],
                                backgroundColor: 'rgba(153, 102, 255, 0.8)',
                                borderColor: 'rgba(153, 102, 255, 1)',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 7,
                                title: {
                                    display: true,
                                    text: 'Rating (1-7)'
                                }
                            }
                        },
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
                
                // Intentions chart
                const intentionsCtx = document.getElementById('intentionsChart').getContext('2d');
                
                new Chart(intentionsCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Historical Use', 'Neighbor Comparison', 'Appliance Breakdown'],
                        datasets: [
                            {
                                label: 'Your Rating',
                                data: [
                                    this.responses.intentions.historical || 0,
                                    this.responses.intentions.neighbor || 0,
                                    this.responses.intentions.appliance || 0
                                ],
                                backgroundColor: 'rgba(93, 92, 222, 0.8)',
                                borderColor: 'rgba(93, 92, 222, 1)',
                                borderWidth: 1
                            },
                            {
                                label: 'Study Average',
                                data: [
                                    this.studyResults.intentions.historical,
                                    this.studyResults.intentions.neighbor,
                                    this.studyResults.intentions.appliance
                                ],
                                backgroundColor: 'rgba(153, 102, 255, 0.8)',
                                borderColor: 'rgba(153, 102, 255, 1)',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 7,
                                title: {
                                    display: true,
                                    text: 'Rating (1-7)'
                                }
                            }
                        },
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            },
            
            // Event handler for the start button
            handleStart() {
                // Randomly assign the format
                const formats = ['table', 'bar', 'icon'];
                this.format = formats[Math.floor(Math.random() * formats.length)];
                
                // Progress to the first information section
                this.progress = 10;
                this.updateProgressBar();
                this.showSection('historical-info');
            },
            
            // Event handler for the historical info next button
            handleHistoricalNext() {
                this.progress = 20;
                this.updateProgressBar();
                this.showSection('historical-questions');
            },
            
            // Event handler for the historical questions next button
            handleHistoricalQuestionsNext() {
                // Check if all questions have been answered
                if (this.responses.understanding.historical.length < 7 ||
                    this.responses.preferences.historical.length < 10 ||
                    !this.responses.intentions.historical) {
                    alert('Please answer all questions before continuing.');
                    return;
                }
                
                this.progress = 30;
                this.updateProgressBar();
                this.showSection('neighbor-info');
            },
            
            // Event handler for the neighbor info next button
            handleNeighborNext() {
                this.progress = 40;
                this.updateProgressBar();
                this.showSection('neighbor-questions');
            },
            
            // Event handler for the neighbor questions next button
            handleNeighborQuestionsNext() {
                // Check if all questions have been answered
                if (this.responses.understanding.neighbor.length < 7 ||
                    this.responses.preferences.neighbor.length < 10 ||
                    !this.responses.intentions.neighbor) {
                    alert('Please answer all questions before continuing.');
                    return;
                }
                
                this.progress = 50;
                this.updateProgressBar();
                this.showSection('appliance-info');
            },
            
            // Event handler for the appliance info next button
            handleApplianceNext() {
                this.progress = 60;
                this.updateProgressBar();
                this.showSection('appliance-questions');
            },
            
            // Event handler for the appliance questions next button
            handleApplianceQuestionsNext() {
                // Check if all questions have been answered
                if (this.responses.understanding.appliance.length < 7 ||
                    this.responses.preferences.appliance.length < 10 ||
                    !this.responses.intentions.appliance) {
                    alert('Please answer all questions before continuing.');
                    return;
                }
                
                this.progress = 70;
                this.updateProgressBar();
                this.showSection('energy-literacy');
            },
            
            // Event handler for the energy literacy next button
            handleEnergyLiteracyNext() {
                // Check if all questions have been answered
                if (this.responses.energyLiteracy.length < 8) {
                    alert('Please answer all questions before continuing.');
                    return;
                }
                
                this.progress = 100;
                this.updateProgressBar();
                this.showSection('results');
            },
            
            // Event handler for the restart button
            handleRestart() {
                // Reset all responses
                this.responses = {
                    understanding: {
                        historical: [],
                        neighbor: [],
                        appliance: []
                    },
                    preferences: {
                        historical: [],
                        neighbor: [],
                        appliance: []
                    },
                    intentions: {
                        historical: null,
                        neighbor: null,
                        appliance: null
                    },
                    energyLiteracy: []
                };
                
                // Reset progress
                this.progress = 0;
                this.updateProgressBar();
                
                // Go back to the intro screen
                this.showSection('intro');
            },
            
            // Event handler for true/false buttons
            handleTrueFalseClick(event) {
                const button = event.target;
                const questionIndex = parseInt(button.getAttribute('data-question'));
                const answer = button.getAttribute('data-answer') === 'true';
                const questionSet = this.currentSection.split('-')[0]; // 'historical', 'neighbor', or 'appliance'
                
                // Get the true/false buttons for this question
                const questionContainer = button.parentElement;
                const buttons = questionContainer.querySelectorAll('.tf-button');
                
                // Remove selected class from all buttons
                buttons.forEach(btn => btn.classList.remove('selected'));
                
                // Add selected class to the clicked button
                button.classList.add('selected');
                
                // Get the correct answer for this question
                const correctAnswer = this.questions.understanding[questionSet][questionIndex].answer;
                
                // Store the response (true if correct, false if incorrect)
                this.responses.understanding[questionSet][questionIndex] = (answer === correctAnswer);
            },
            
            // Event handler for Likert scale buttons
            handleLikertClick(event) {
                const button = event.target;
                const questionIndex = parseInt(button.getAttribute('data-question'));
                const value = parseInt(button.getAttribute('data-value'));
                const questionSet = this.currentSection.split('-')[0]; // 'historical', 'neighbor', or 'appliance'
                
                // Get the Likert scale buttons for this question
                const questionContainer = button.parentElement;
                const buttons = questionContainer.querySelectorAll('.likert-btn');
                
                // Remove selected class from all buttons
                buttons.forEach(btn => btn.classList.remove('selected'));
                
                // Add selected class to the clicked button
                button.classList.add('selected');
                
                // Store the response
                this.responses.preferences[questionSet][questionIndex] = value;
            },
            
            // Event handler for intention buttons
            handleIntentionClick(event) {
                const button = event.target;
                const value = parseInt(button.getAttribute('data-value'));
                const questionSet = this.currentSection.split('-')[0]; // 'historical', 'neighbor', or 'appliance'
                
                // Get the Likert scale buttons for this question
                const buttons = document.querySelectorAll('.intention-btn');
                
                // Remove selected class from all buttons
                buttons.forEach(btn => btn.classList.remove('selected'));
                
                // Add selected class to the clicked button
                button.classList.add('selected');
                
                // Store the response
                this.responses.intentions[questionSet] = value;
            },
            
            // Event handler for energy literacy option buttons
            handleOptionClick(event) {
                const button = event.target;
                const questionIndex = parseInt(button.getAttribute('data-question'));
                const optionIndex = parseInt(button.getAttribute('data-option'));
                
                // Get the option buttons for this question
                const questionContainer = button.parentElement;
                const buttons = questionContainer.querySelectorAll('.option-btn');
                
                // Remove selected class from all buttons
                buttons.forEach(btn => btn.classList.remove('selected'));
                
                // Add selected class to the clicked button
                button.classList.add('selected');
                
                // Get the correct answer for this question
                const correctAnswer = this.questions.energyLiteracy[questionIndex].answer;
                
                // Store the response (true if correct, false if incorrect)
                this.responses.energyLiteracy[questionIndex] = (optionIndex === correctAnswer);
            }
        };
        
        // Initialize the app
        app.init();
        
        // Event delegation for button clicks
        document.addEventListener('click', function(event) {
            // Start button
            if (event.target.id === 'startBtn') {
                app.handleStart();
            }
            
            // Historical info next button
            if (event.target.id === 'historicalNextBtn') {
                app.handleHistoricalNext();
            }
            
            // Historical questions next button
            if (event.target.id === 'historicalQuestionsNextBtn') {
                app.handleHistoricalQuestionsNext();
            }
            
            // Neighbor info next button
            if (event.target.id === 'neighborNextBtn') {
                app.handleNeighborNext();
            }
            
            // Neighbor questions next button
            if (event.target.id === 'neighborQuestionsNextBtn') {
                app.handleNeighborQuestionsNext();
            }
            
            // Appliance info next button
            if (event.target.id === 'applianceNextBtn') {
                app.handleApplianceNext();
            }
            
            // Appliance questions next button
            if (event.target.id === 'applianceQuestionsNextBtn') {
                app.handleApplianceQuestionsNext();
            }
            
            // Energy literacy next button
            if (event.target.id === 'energyLiteracyNextBtn') {
                app.handleEnergyLiteracyNext();
            }
            
            // Restart button
            if (event.target.id === 'restartBtn') {
                app.handleRestart();
            }
            
            // True/False buttons
            if (event.target.classList.contains('tf-button')) {
                app.handleTrueFalseClick(event);
            }
            
            // Likert scale buttons (not intention buttons)
            if (event.target.classList.contains('likert-btn') && !event.target.classList.contains('intention-btn')) {
                app.handleLikertClick(event);
            }
            
            // Intention buttons
            if (event.target.classList.contains('intention-btn')) {
                app.handleIntentionClick(event);
            }
            
            // Energy literacy option buttons
            if (event.target.classList.contains('option-btn')) {
                app.handleOptionClick(event);
            }
        });
    </script>


</body></html>