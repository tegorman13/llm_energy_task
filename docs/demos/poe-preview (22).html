<!DOCTYPE html><html lang="en"><head><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Energy Planning Dashboard</title>
  <!-- React and dependencies -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- No external tab libraries needed -->
  
  <style>
    :root {
      --primary-color: #5D5CDE;
      --light-bg: #FFFFFF;
      --dark-bg: #181818;
      --light-text: #333333;
      --dark-text: #EEEEEE;
      --light-border: #DDDDDD;
      --dark-border: #444444;
    }
    
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background-color: var(--light-bg);
      color: var(--light-text);
    }
    
    .dashboard-header {
      margin-bottom: 20px;
      border-bottom: 2px solid var(--primary-color);
      padding-bottom: 10px;
    }
    
    .control-panel {
      background-color: #f8f8f8;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .control-group {
      margin-right: 20px;
    }
    
    .control-label {
      font-weight: bold;
      margin-right: 8px;
    }
    
    .task-container {
      padding: 20px;
      border: 1px solid var(--light-border);
      border-radius: 5px;
      margin-top: 10px;
    }
    
    .step-container {
      margin-bottom: 20px;
      padding: 15px;
      background-color: #f9f9f9;
      border-radius: 5px;
    }
    
    .step-title {
      font-weight: bold;
      margin-bottom: 10px;
      color: var(--primary-color);
    }
    
    button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
      margin-top: 10px;
    }
    
    button:hover {
      opacity: 0.9;
    }
    
    input, select, textarea {
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin: 5px 0;
    }
    
    .appliance-item {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
      padding: 10px;
      background-color: #f0f0f0;
      border-radius: 4px;
    }
    
    .appliance-name {
      flex: 1;
      font-weight: bold;
    }
    
    .appliance-input {
      width: 100px;
    }
    
    .ai-explanation {
      background-color: #f0f4ff;
      padding: 12px;
      border-left: 3px solid var(--primary-color);
      margin: 10px 0;
    }
    
    .plan-item {
      background-color: #f0f8ff;
      padding: 10px;
      margin: 5px 0;
      border-radius: 4px;
    }
    
    .if-then-preview {
      margin-top: 15px;
      padding: 15px;
      background-color: #f0fff0;
      border: 1px dashed green;
      border-radius: 5px;
    }
    
    .error {
      color: red;
      font-weight: bold;
    }
    
    .seed-plan {
      padding: 15px;
      background-color: #f5f5f5;
      border-radius: 5px;
      margin-bottom: 15px;
    }
    
    .plan-action {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      padding: 8px;
      background-color: #f8f8f8;
      border-radius: 4px;
    }
    
    .savings-display {
      font-weight: bold;
      color: green;
    }
    
    .quiz-question {
      margin-bottom: 15px;
      padding: 15px;
      background-color: #f0f0f0;
      border-radius: 5px;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
    }
    
    table th, table td {
      padding: 8px;
      border: 1px solid #ddd;
      text-align: left;
    }
    
    table th {
      background-color: #f2f2f2;
    }
    
    /* Custom tabs styling */
    .custom-tabs {
      margin-top: 20px;
    }
    
    .tab-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-bottom: 10px;
    }
    
    .tab-buttons button {
      padding: 10px 15px;
      background-color: #f0f0f0;
      color: #333;
      border: 1px solid #ccc;
      border-radius: 4px 4px 0 0;
      cursor: pointer;
    }
    
    .tab-buttons button.active {
      background-color: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }
    
    .tab-content {
      border: 1px solid #ccc;
      border-radius: 0 4px 4px 4px;
      padding: 15px;
    }
    
    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
      body {
        background-color: var(--dark-bg);
        color: var(--dark-text);
      }
      
      .control-panel {
        background-color: #222;
      }
      
      .task-container {
        border-color: var(--dark-border);
      }
      
      .step-container, .appliance-item, .quiz-question, .seed-plan, .plan-action {
        background-color: #2a2a2a;
      }
      
      .ai-explanation {
        background-color: #2a3044;
      }
      
      .plan-item {
        background-color: #2a3a44;
      }
      
      .if-then-preview {
        background-color: #2a3a2a;
        border-color: #4d8d4d;
      }
      
      input, select, textarea {
        background-color: #333;
        color: var(--dark-text);
        border-color: #555;
      }
      
      table th {
        background-color: #333;
      }
      
      table th, table td {
        border-color: #444;
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect } = React;
    
    // Real appliance energy data from Attari and Marghetis studies
    const APPLIANCE_DATA = {
      "CFL": 23,
      "Desktop": 138, 
      "Laptop": 32,
      "Stereo": 33,
      "WAC": 1157, // Window air conditioner
      "CAC": 3797, // Central air conditioner
      "Dryer": 3938,
      "Dishwasher": 1201,
      "Incan_bulb": 100, // Reference point: 100W bulb
      "Heater": 1290,
      "Smartphone": 3.42,
      "TV": 68,
      "Fan": 69,
      "Fridge": 364
    };
    
    // Energy-saving actions with realistic data
    const ENERGY_ACTIONS = [
      {
        name: "Replace incandescent bulbs with LEDs",
        category: "Lighting",
        difficulty: 2, // From Attari scale
        savings: 75, // Percentage
        kWhSavings: 85 // Annual kWh
      },
      {
        name: "Lower thermostat by 2°F in winter",
        category: "Heating",
        difficulty: 3,
        savings: 5,
        kWhSavings: 546 // From Attari data
      },
      {
        name: "Raise thermostat by 2°F in summer",
        category: "Cooling",
        difficulty: 3,
        savings: 6,
        kWhSavings: 115 // From Attari data
      },
      {
        name: "Line dry clothes instead of using dryer",
        category: "Appliances",
        difficulty: 5,
        savings: 12,
        kWhSavings: 3938 // From Attari data
      },
      {
        name: "Wash clothes in cold water",
        category: "Appliances",
        difficulty: 2,
        savings: 4,
        kWhSavings: 4000 // From Attari data
      },
      {
        name: "Replace old refrigerator with ENERGY STAR model",
        category: "Appliances",
        difficulty: 6,
        savings: 15,
        kWhSavings: 1100
      },
      {
        name: "Install programmable thermostat",
        category: "HVAC",
        difficulty: 4,
        savings: 10,
        kWhSavings: 1200
      },
      {
        name: "Unplug electronics when not in use",
        category: "Electronics",
        difficulty: 2,
        savings: 2,
        kWhSavings: 180
      }
    ];
    
    // Pre-generated AI explanations
    const AI_EXPLANATIONS = {
      "CFL": "CFLs use about 75-80% less energy than incandescent bulbs for the same brightness. This is because they don't waste as much energy as heat.",
      "WAC": "Window air conditioners use a lot of energy because they actively cool air using a compressor and refrigerant. At 1157 units, they use over 10x the energy of a 100W bulb.",
      "Dryer": "Clothes dryers are extremely energy-intensive because they must generate substantial heat to evaporate water. At 3938 units, a typical dryer uses about 40 times more energy than a 100W bulb for one hour.",
      "Laptop": "Laptops are engineered to be energy-efficient since they often run on batteries. At 32 units, a typical laptop uses less than a third of the energy of a 100W bulb.",
      "Fan": "Ceiling fans are relatively efficient, using only about 69 units - less than a 100W bulb. They move air rather than changing its temperature, which requires much less energy.",
      "Fridge": "Refrigerators run 24/7, so even though they cycle on and off, their annual energy use is substantial. Modern ENERGY STAR fridges are much more efficient than older models."
    };
    
    // Seed plan templates for anchoring task
    const SEED_PLANS = {
      accurate: [
        {
          action: "Replace 5 incandescent bulbs with LEDs",
          savings: 425, // kWh/year
          explanation: "LEDs use ~75% less energy than incandescents"
        },
        {
          action: "Lower thermostat by 2°F during winter",
          savings: 546, // From Attari
          explanation: "Heating uses substantial energy, so small adjustments save a lot"
        },
        {
          action: "Line-dry clothes instead of using dryer once weekly",
          savings: 205, // Calculated from Attari
          explanation: "Clothes dryers use significant energy to generate heat"
        }
      ],
      biased: [
        {
          action: "Turn off lights when not in use",
          savings: 150, // Overestimated
          explanation: "Lighting is a significant energy drain in most homes"
        },
        {
          action: "Unplug phone chargers when not in use",
          savings: 50, // Significantly overestimated
          explanation: "Phantom power from chargers adds up over time"
        },
        {
          action: "Turn off computer at night",
          savings: 175,
          explanation: "Electronics use energy even in sleep mode"
        }
      ]
    };
    
    // Quiz questions for metacognitive tutoring
    const QUIZ_QUESTIONS = [
      {
        id: "q1",
        question: "Which uses less energy per hour?",
        options: ["Window AC", "Ceiling Fan"],
        correctAnswer: "Ceiling Fan"
      },
      {
        id: "q2",
        question: "How many hours would you need to turn off a 100W light bulb to save the same energy as not using a clothes dryer for one load?",
        type: "numeric",
        correctAnswer: 40, // ~4000 units for dryer / 100 units per hour
        acceptableRange: [30, 50]
      },
      {
        id: "q3",
        question: "True or False: Replacing incandescent bulbs with LEDs saves more energy than adjusting your thermostat by 2°F in winter.",
        options: ["True", "False"],
        correctAnswer: "False" // Thermostat saves more (546 vs ~85 per bulb)
      }
    ];
    
    // ---- TASK 1: Estimate-Then-Plan with AI Explanations ----
    function Task1EstimateThenPlan({ goalFormat }) {
      const [step, setStep] = useState('estimate');
      const [estimates, setEstimates] = useState({});
      const [showExplanations, setShowExplanations] = useState(true);
      const [plan, setPlan] = useState([]);
      
      // Subset of appliances for estimation (from Attari's Q3)
      const appliancesToEstimate = ["CFL", "Laptop", "WAC", "Dryer", "Fan", "Fridge"];
      
      const handleEstimateChange = (appliance, value) => {
        setEstimates({...estimates, [appliance]: parseInt(value) || 0});
      };
      
      const handleAddAction = (action) => {
        setPlan([...plan, action]);
      };
      
      const handleRemoveAction = (index) => {
        const newPlan = [...plan];
        newPlan.splice(index, 1);
        setPlan(newPlan);
      };
      
      const getTotalSavings = () => {
        return plan.reduce((sum, action) => sum + action.kWhSavings, 0);
      };
      
      const formatSavings = (value) => {
        if (goalFormat === 'kWh') return `${value} kWh/year`;
        if (goalFormat === '%') return `${Math.round(value/50)}%`; // Simplified conversion
        return `$${Math.round(value * 0.12)}/year`; // Assuming $0.12/kWh
      };
      
      return (
        <div className="task-container">
          <h2>Task 1: Estimate-Then-Plan with AI Explanations</h2>
          <p>This task tests how providing explanations about appliance energy use affects subsequent plan accuracy.</p>
          
          <div className="control-panel">
            <label>
              <input
                type="checkbox"
                checked={showExplanations}
                onChange={() => setShowExplanations(!showExplanations)}
              />
              Include AI Explanations (not just numbers)
            </label>
          </div>
          
          {step === 'estimate' && (
            <div className="step-container">
              <div className="step-title">STEP 1: Estimate Energy Use</div>
              <p>A 100-Watt incandescent light bulb uses 100 units of energy in one hour.
              How many units do you think each of the following devices typically uses in one hour?</p>
              
              {appliancesToEstimate.map(appliance => (
                <div key={appliance} className="appliance-item">
                  <span className="appliance-name">{appliance}</span>
                  <input
                    type="number"
                    min="0"
                    className="appliance-input"
                    onChange={(e) => handleEstimateChange(appliance, e.target.value)}
                    placeholder="Units per hour"
                  />
                </div>
              ))}
              
              <button onClick={() => setStep('feedback')}>Submit Estimates</button>
            </div>
          )}
          
          {step === 'feedback' && (
            <div className="step-container">
              <div className="step-title">STEP 2: Feedback on Estimates</div>
              
              {appliancesToEstimate.map(appliance => (
                <div key={appliance} className="appliance-item">
                  <div>
                    <strong>{appliance}:</strong>
                    <p>Your estimate: {estimates[appliance] || 'Not provided'} units</p>
                    <p>Actual value: {APPLIANCE_DATA[appliance]} units</p>
                    
                    {showExplanations && AI_EXPLANATIONS[appliance] && (
                      <div className="ai-explanation">
                        <strong>AI Explanation:</strong> {AI_EXPLANATIONS[appliance]}
                      </div>
                    )}
                  </div>
                </div>
              ))}
              
              <button onClick={() => setStep('plan')}>Continue to Planning</button>
            </div>
          )}
          
          {step === 'plan' && (
            <div className="step-container">
              <div className="step-title">STEP 3: Create Your Energy Reduction Plan</div>
              <p>Now that you understand appliance energy use better, create a plan to reduce energy consumption.</p>
              
              <div>
                <h4>Available Actions:</h4>
                {ENERGY_ACTIONS.map(action => (
                  <div key={action.name} className="plan-action">
                    <span>{action.name}</span>
                    <span>Saves: {formatSavings(action.kWhSavings)}</span>
                    <button onClick={() => handleAddAction(action)}>Add to Plan</button>
                  </div>
                ))}
                
                <h4>Your Plan:</h4>
                {plan.length === 0 ? (
                  <p>Your plan is empty. Add some actions above.</p>
                ) : (
                  <div>
                    {plan.map((action, index) => (
                      <div key={index} className="plan-item">
                        <div className="plan-action">
                          <span>{action.name}</span>
                          <span>Saves: {formatSavings(action.kWhSavings)}</span>
                          <button onClick={() => handleRemoveAction(index)}>Remove</button>
                        </div>
                      </div>
                    ))}
                    
                    <div className="savings-display">
                      Total Estimated Savings: {formatSavings(getTotalSavings())}
                    </div>
                  </div>
                )}
                
                <button onClick={() => alert("Plan submitted!")}>Submit Final Plan</button>
              </div>
            </div>
          )}
        </div>
      );
    }
    
    // ---- TASK 2: Implementation-Intention Wizard ----
    function Task2ImplementationIntention({ goalFormat }) {
      const [selectedAction, setSelectedAction] = useState('');
      const [when, setWhen] = useState('');
      const [where, setWhere] = useState('');
      const [reminder, setReminder] = useState('');
      const [difficulty, setDifficulty] = useState(4); // 1-8 scale from Attari
      const [plans, setPlans] = useState([]);
      
      const handleCreatePlan = () => {
        if (!selectedAction || !when || !where || !reminder) {
          alert("Please complete all fields");
          return;
        }
        
        // Find the selected action details
        const actionDetails = ENERGY_ACTIONS.find(a => a.name === selectedAction);
        
        const newPlan = {
          action: selectedAction,
          when,
          where,
          reminder,
          difficulty,
          savings: actionDetails?.kWhSavings || 0
        };
        
        setPlans([...plans, newPlan]);
        
        // Reset form
        setSelectedAction('');
        setWhen('');
        setWhere('');
        setReminder('');
      };
      
      const formatSavings = (value) => {
        if (goalFormat === 'kWh') return `${value} kWh/year`;
        if (goalFormat === '%') return `${Math.round(value/50)}%`;
        return `$${Math.round(value * 0.12)}/year`;
      };
      
      return (
        <div className="task-container">
          <h2>Task 2: Implementation-Intention Wizard</h2>
          <p>This task helps create "if-then" plans to bridge the intention-action gap. Breaking down "when", "where" and "how" increases follow-through.</p>
          
          <div className="step-container">
            <div className="step-title">Create Your Implementation Intention</div>
            
            <div className="form-group">
              <label>Select an Action:</label>
              <select 
                value={selectedAction}
                onChange={e => setSelectedAction(e.target.value)}
              >
                <option value="">-- Select an Action --</option>
                {ENERGY_ACTIONS.map(action => (
                  <option key={action.name} value={action.name}>
                    {action.name} - Saves {formatSavings(action.kWhSavings)}
                  </option>
                ))}
              </select>
            </div>
            
            <div className="form-group">
              <label>When will you do this?</label>
              <input
                type="text"
                value={when}
                onChange={e => setWhen(e.target.value)}
                placeholder="e.g., Every Sunday morning, or Next weekend"
              />
            </div>
            
            <div className="form-group">
              <label>Where will you do this?</label>
              <input
                type="text"
                value={where}
                onChange={e => setWhere(e.target.value)}
                placeholder="e.g., In my living room, or At home"
              />
            </div>
            
            <div className="form-group">
              <label>How will you remember to do this?</label>
              <input
                type="text"
                value={reminder}
                onChange={e => setReminder(e.target.value)}
                placeholder="e.g., Set a phone alarm, or Put a note on fridge"
              />
            </div>
            
            <div className="form-group">
              <label>How difficult will this be? (1-8 scale from Attari)</label>
              <select
                value={difficulty}
                onChange={e => setDifficulty(parseInt(e.target.value))}
              >
                <option value="1">1 - Do it already</option>
                <option value="2">2 - Extremely easy</option>
                <option value="3">3 - Very easy</option>
                <option value="4">4 - Somewhat easy</option>
                <option value="5">5 - Neither easy nor hard</option>
                <option value="6">6 - Somewhat hard</option>
                <option value="7">7 - Very hard</option>
                <option value="8">8 - Extremely hard</option>
              </select>
            </div>
            
            <button onClick={handleCreatePlan}>Create Implementation Plan</button>
            
            {selectedAction && when && where && reminder && (
              <div className="if-then-preview">
                <h4>Preview of your implementation intention:</h4>
                <p>
                  <strong>IF</strong> I am <strong>{where}</strong> <strong>{when}</strong>, 
                  <strong>THEN</strong> I will <strong>{selectedAction}</strong>.
                </p>
                <p>I will remember by: <strong>{reminder}</strong></p>
              </div>
            )}
          </div>
          
          {plans.length > 0 && (
            <div className="step-container">
              <div className="step-title">Your Implementation Plans</div>
              
              {plans.map((plan, index) => (
                <div key={index} className="plan-item">
                  <p>
                    <strong>IF</strong> I am <strong>{plan.where}</strong> <strong>{plan.when}</strong>, 
                    <strong>THEN</strong> I will <strong>{plan.action}</strong>.
                  </p>
                  <p>I will remember by: <strong>{plan.reminder}</strong></p>
                  <p>Difficulty rating: {plan.difficulty}/8</p>
                  <p>Estimated savings: {formatSavings(plan.savings)}</p>
                </div>
              ))}
              
              <button onClick={() => {
                // Generate printable contract
                const contract = plans.map(p => 
                  `IF I am ${p.where} ${p.when}, THEN I will ${p.action}. I'll remember by ${p.reminder}.`
                ).join('\n\n');
                
                alert("Contract ready to print:\n\n" + contract);
              }}>
                Print "Contract"
              </button>
            </div>
          )}
        </div>
      );
    }
    
    // ---- TASK 3: Anchoring-and-Adjustment with AI Seed Plans ----
    function Task3AnchoringAdjustment({ goalFormat }) {
      const [seedType, setSeedType] = useState('accurate');
      const [seedPlan, setSeedPlan] = useState([]);
      const [editedPlan, setEditedPlan] = useState([]);
      
      // Load seed plan when type changes
      useEffect(() => {
        setSeedPlan(SEED_PLANS[seedType]);
        setEditedPlan(JSON.parse(JSON.stringify(SEED_PLANS[seedType]))); // Deep copy
      }, [seedType]);
      
      const handleUpdateAction = (index, field, value) => {
        const newPlan = [...editedPlan];
        newPlan[index][field] = field === 'savings' ? (parseInt(value) || 0) : value;
        setEditedPlan(newPlan);
      };
      
      const handleRemoveAction = (index) => {
        const newPlan = [...editedPlan];
        newPlan.splice(index, 1);
        setEditedPlan(newPlan);
      };
      
      const handleAddAction = () => {
        setEditedPlan([...editedPlan, {
          action: "New action",
          savings: 100,
          explanation: "Custom explanation"
        }]);
      };
      
      const getTotalSavings = () => {
        return editedPlan.reduce((sum, item) => sum + item.savings, 0);
      };
      
      const formatSavings = (value) => {
        if (goalFormat === 'kWh') return `${value} kWh/year`;
        if (goalFormat === '%') return `${Math.round(value/50)}%`;
        return `$${Math.round(value * 0.12)}/year`;
      };
      
      return (
        <div className="task-container">
          <h2>Task 3: Anchoring-and-Adjustment with AI Seed Plans</h2>
          <p>This task provides an AI-generated "seed" plan that you can adjust to create your final plan.</p>
          
          <div className="control-panel">
            <label className="control-label">Seed Plan Type:</label>
            <select
              value={seedType}
              onChange={e => setSeedType(e.target.value)}
            >
              <option value="accurate">Accurate Plan (Balanced)</option>
              <option value="biased">Biased Plan (Low-impact focused)</option>
            </select>
          </div>
          
          <div className="step-container">
            <div className="step-title">AI-Generated Seed Plan</div>
            
            <div className="ai-explanation">
              <strong>Note from AI:</strong> This is a suggested starting plan to reduce your energy use. Feel free to edit it to match your preferences.
              {seedType === 'accurate' && (
                <span> Remember that large appliances that heat or cool things often use more energy than people think.</span>
              )}
            </div>
            
            <div className="seed-plan">
              <h4>Original AI Plan:</h4>
              <ul>
                {seedPlan.map((item, index) => (
                  <li key={index}>
                    <strong>{item.action}</strong> - Saves {formatSavings(item.savings)}
                    <div><small>{item.explanation}</small></div>
                  </li>
                ))}
              </ul>
            </div>
            
            <div className="step-title">Your Edited Plan</div>
            <p>Edit the plan below to create your own version:</p>
            
            {editedPlan.map((item, index) => (
              <div key={index} className="plan-item">
                <div className="form-group">
                  <label>Action:</label>
                  <input
                    type="text"
                    value={item.action}
                    onChange={e => handleUpdateAction(index, 'action', e.target.value)}
                    style={{width: '80%'}}
                  />
                </div>
                
                <div className="form-group">
                  <label>Estimated Savings ({goalFormat}):</label>
                  <input
                    type="number"
                    value={item.savings}
                    onChange={e => handleUpdateAction(index, 'savings', e.target.value)}
                    style={{width: '100px'}}
                  />
                  {goalFormat === 'kWh' ? ' kWh/year' : goalFormat === '%' ? '%' : '$/year'}
                </div>
                
                <div className="form-group">
                  <label>Explanation:</label>
                  <input
                    type="text"
                    value={item.explanation}
                    onChange={e => handleUpdateAction(index, 'explanation', e.target.value)}
                    style={{width: '80%'}}
                  />
                </div>
                
                <button onClick={() => handleRemoveAction(index)}>Remove Action</button>
              </div>
            ))}
            
            <button onClick={handleAddAction}>+ Add New Action</button>
            
            <div className="savings-display">
              Total Estimated Savings: {formatSavings(getTotalSavings())}
            </div>
            
            <button onClick={() => alert("Plan submitted!")}>Submit Final Plan</button>
          </div>
        </div>
      );
    }
    
    // ---- TASK 4: Metacognitive Tutoring Loop ----
    function Task4MetacognitiveTutoring({ goalFormat }) {
      const [stage, setStage] = useState('quiz');
      const [answers, setAnswers] = useState({});
      const [score, setScore] = useState(0);
      const [teachingMode, setTeachingMode] = useState('');
      const [plan, setPlan] = useState('');
      const [confidence, setConfidence] = useState(3); // 1-5 scale
      
      const handleAnswerChange = (questionId, value) => {
        setAnswers({...answers, [questionId]: value});
      };
      
      const handleQuizSubmit = () => {
        // Grade the quiz
        let newScore = 0;
        
        // Check Q1 (MC)
        if (answers.q1 === 'Ceiling Fan') newScore++;
        
        // Check Q2 (numeric)
        const q2Answer = parseInt(answers.q2);
        if (q2Answer >= 30 && q2Answer <= 50) newScore++;
        
        // Check Q3 (T/F)
        if (answers.q3 === 'False') newScore++;
        
        setScore(newScore);
        
        // Set teaching mode based on score
        setTeachingMode(newScore >= 2 ? 'tables' : 'socratic');
        setStage('tutoring');
      };
      
      return (
        <div className="task-container">
          <h2>Task 4: Metacognitive Tutoring Loop</h2>
          <p>This task adapts to your knowledge level to help create an accurate plan.</p>
          
          {stage === 'quiz' && (
            <div className="step-container">
              <div className="step-title">Quick Knowledge Check</div>
              <p>First, we'll test your knowledge of appliance energy use.</p>
              
              {QUIZ_QUESTIONS.map(q => (
                <div key={q.id} className="quiz-question">
                  <p><strong>{q.question}</strong></p>
                  
                  {q.type === 'numeric' ? (
                    <input
                      type="number"
                      onChange={e => handleAnswerChange(q.id, e.target.value)}
                      placeholder="Enter a number"
                    />
                  ) : (
                    <div>
                      {q.options.map(option => (
                        <label key={option} style={{display: 'block', margin: '5px 0'}}>
                          <input
                            type="radio"
                            name={q.id}
                            value={option}
                            onChange={() => handleAnswerChange(q.id, option)}
                          />
                          {option}
                        </label>
                      ))}
                    </div>
                  )}
                </div>
              ))}
              
              <button onClick={handleQuizSubmit}>Submit Answers</button>
            </div>
          )}
          
          {stage === 'tutoring' && (
            <div className="step-container">
              <div className="step-title">Energy Knowledge Tutoring</div>
              <p>Your score: {score} out of 3</p>
              
              {teachingMode === 'tables' ? (
                <div>
                  <p>Based on your good score, here's a reference table of appliance energy use:</p>
                  
                  <table>
                    <thead>
                      <tr>
                        <th>Appliance</th>
                        <th>Energy Use (units/hour)</th>
                        <th>Typical Usage Pattern</th>
                        <th>Annual Impact (kWh)</th>
                      </tr>
                    </thead>
                    <tbody>
                      {Object.entries(APPLIANCE_DATA).map(([appliance, value]) => (
                        <tr key={appliance}>
                          <td>{appliance}</td>
                          <td>{value}</td>
                          <td>
                            {appliance === 'Dryer' ? '3-4 loads/week' :
                             appliance === 'WAC' ? '8 hours/day (summer)' :
                             appliance === 'Fridge' ? '24/7 operation' :
                             'Variable'}
                          </td>
                          <td>
                            {Math.round(value * 
                              (appliance === 'Dryer' ? 4 * 52 : 
                               appliance === 'WAC' ? 8 * 90 :
                               appliance === 'Fridge' ? 24 * 365 :
                               100))}
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                  
                  <p>Use this table to inform your energy saving plan.</p>
                </div>
              ) : (
                <div>
                  <p>Let's work through some key concepts to improve your understanding:</p>
                  
                  <div className="ai-explanation">
                    <p><strong>Question:</strong> You thought a Window AC uses less energy than a ceiling fan. Let's think about how each works - what is the difference?</p>
                    <textarea rows="3" placeholder="Type your thoughts here..."></textarea>
                    <p><strong>AI Response:</strong> An air conditioner must actively cool air using a compressor and refrigerant, which requires substantial energy. A fan simply moves air around without changing its temperature. This is why a window AC uses about 1157 units/hour while a fan uses only 69 units/hour - nearly 17 times less!</p>
                  </div>
                  
                  <div className="ai-explanation">
                    <p><strong>Question:</strong> For the dryer question, let's calculate: A typical clothes dryer uses about 3940 units per load. A 100W bulb uses 100 units per hour. How many hours of the bulb equals one dryer load?</p>
                    <textarea rows="3" placeholder="Type your calculation here..."></textarea>
                    <p><strong>AI Response:</strong> To find the equivalent, we divide: 3940 ÷ 100 = 39.4 hours. This means using the dryer once consumes the same energy as leaving a 100W bulb on for nearly 40 hours! This illustrates why dryers are considered high-impact appliances.</p>
                  </div>
                </div>
              )}
              
              <button onClick={() => setStage('planning')}>Continue to Planning</button>
            </div>
          )}
          
          {stage === 'planning' && (
            <div className="step-container">
              <div className="step-title">Create Your Energy Saving Plan</div>
              <p>Based on what you've learned, create a concrete plan to reduce your energy consumption.</p>
              
              <textarea
                value={plan}
                onChange={e => setPlan(e.target.value)}
                rows="8"
                placeholder="List specific actions you will take to save energy, focusing on high-impact appliances..."
                style={{width: '100%'}}
              ></textarea>
              
              <div className="form-group">
                <label>How confident are you that your plan will save significant energy?</label>
                <select
                  value={confidence}
                  onChange={e => setConfidence(parseInt(e.target.value))}
                >
                  <option value="1">1 - Not at all confident</option>
                  <option value="2">2 - Slightly confident</option>
                  <option value="3">3 - Moderately confident</option>
                  <option value="4">4 - Very confident</option>
                  <option value="5">5 - Extremely confident</option>
                </select>
              </div>
              
              <button onClick={() => alert("Plan submitted!")}>Submit Final Plan</button>
            </div>
          )}
        </div>
      );
    }
    
    // Main Dashboard Component
    function Dashboard() {
      const [goalFormat, setGoalFormat] = useState('kWh');
      const [activeTab, setActiveTab] = useState(0);
      
      return (
        <div>
          <div className="dashboard-header">
            <h1>Interactive Energy Planning Dashboard</h1>
            <p>This dashboard demonstrates four experimental tasks for energy conservation planning, incorporating materials from Attari et al. (2010) and Marghetis et al. (2019).</p>
          </div>
          
          <div className="control-panel">
            <div className="control-group">
              <label className="control-label">Goal Format:</label>
              <select
                value={goalFormat}
                onChange={e => setGoalFormat(e.target.value)}
              >
                <option value="kWh">kWh (Absolute)</option>
                <option value="%">Percentage (%)</option>
                <option value="USD">Monetary (USD)</option>
              </select>
            </div>
            
            <div>
              <p><strong>Current Settings:</strong> Using {goalFormat} as the goal format</p>
            </div>
          </div>
          
          <div className="custom-tabs">
            <div className="tab-buttons">
              <button 
                onClick={() => setActiveTab(0)} 
                className={activeTab === 0 ? 'active' : ''}
              >
                Task 1: Estimate-then-Plan
              </button>
              <button 
                onClick={() => setActiveTab(1)} 
                className={activeTab === 1 ? 'active' : ''}
              >
                Task 2: Implementation Wizard
              </button>
              <button 
                onClick={() => setActiveTab(2)} 
                className={activeTab === 2 ? 'active' : ''}
              >
                Task 3: Anchoring & Adjustment
              </button>
              <button 
                onClick={() => setActiveTab(3)} 
                className={activeTab === 3 ? 'active' : ''}
              >
                Task 4: Metacognitive Tutoring
              </button>
            </div>
            
            <div className="tab-content">
              {activeTab === 0 && <Task1EstimateThenPlan goalFormat={goalFormat} />}
              {activeTab === 1 && <Task2ImplementationIntention goalFormat={goalFormat} />}
              {activeTab === 2 && <Task3AnchoringAdjustment goalFormat={goalFormat} />}
              {activeTab === 3 && <Task4MetacognitiveTutoring goalFormat={goalFormat} />}
            </div>
          </div>
        </div>
      );
    }
    
    // Render the application using React 18's createRoot API
    const container = document.getElementById('root');
    const root = ReactDOM.createRoot(container);
    root.render(<Dashboard />);
  </script>


</body></html>