<!DOCTYPE html><html lang="en"><head><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Electricity Bill Study Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
        }
        
        h1, h2, h3 {
            color: #2c3e50;
        }
        
        .container {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }
        
        .btn:hover {
            background-color: #2980b9;
        }
        
        .btn-selected {
            background-color: #2c3e50;
        }
        
        .question {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .options {
            margin-top: 10px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
        }
        
        input[type="radio"] {
            margin-right: 5px;
        }
        
        .hidden {
            display: none;
        }
        
        .info-display {
            background-color: white;
            border: 1px solid #ddd;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
            overflow-x: auto;
        }
        
        table {
            border-collapse: collapse;
            width: 100%;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        
        th {
            background-color: #f2f2f2;
        }
        
        .progress-bar {
            background-color: #e0e0e0;
            height: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .progress {
            background-color: #3498db;
            height: 100%;
            border-radius: 10px;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .likert-scale {
            display: flex;
            justify-content: space-between;
            margin: 10px 0 30px 0;
        }
        
        .likert-option {
            text-align: center;
            width: 14%;
        }
        
        .results {
            margin-top: 20px;
        }
        
        canvas {
            max-width: 100%;
            height: auto;
        }
        
        .icon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(30px, 1fr));
            gap: 2px;
        }
        
        .icon {
            width: 20px;
            height: 20px;
            background-color: #3498db;
            margin: 2px;
        }
        
        .stacked-bar {
            height: 30px;
            display: flex;
            margin: 5px 0;
        }
        
        .bar-segment {
            height: 100%;
        }
        
        .neighbor-comparison {
            display: flex;
            align-items: flex-end;
            height: 300px;
        }
        
        .neighbor-bar {
            flex: 1;
            background-color: #3498db;
            margin: 0 2px;
            position: relative;
        }
        
        .your-home {
            background-color: #e74c3c;
        }
        
        .neighbor-label {
            position: absolute;
            bottom: -20px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 12px;
        }
        
        .section-title {
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
            margin-top: 30px;
        }
        
        @media (max-width: 600px) {
            .likert-scale {
                flex-direction: column;
            }
            
            .likert-option {
                width: 100%;
                margin-bottom: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="intro-section">
        <h1>Electricity Bill Study Demo</h1>
        <p>This interactive demonstration replicates a study on how different ways of presenting electricity usage information affects understanding, preferences, and intentions to save electricity.</p>
        <p>In this demo, you will:</p>
        <ol>
            <li>Choose to see electricity information in one of three formats</li>
            <li>View three types of electricity usage information for the Smith family</li>
            <li>Answer questions about your understanding and opinions of each information display</li>
            <li>Complete a brief energy literacy assessment</li>
        </ol>
        <p>This demonstration is based on the research paper: "Perceptions of electricity-use communications: effects of information, format, and individual differences" by Casey Canfield, WÃ¤ndi Bruine de Bruin, and Gabrielle Wong-Parodi (2017).</p>
        <button class="btn" id="start-btn">Start Demo</button>
    </div>

    <div class="container hidden" id="format-section">
        <h2>Choose a Format</h2>
        <p>In the original study, participants were randomly assigned to one of three formats. For this demo, please select which format you'd like to experience:</p>
        <div>
            <button class="btn" id="table-btn">Table Format</button>
            <button class="btn" id="bar-btn">Bar Graph Format</button>
            <button class="btn" id="icon-btn">Icon Graph Format</button>
        </div>
    </div>

    <div class="container hidden" id="progress-section">
        <div class="progress-bar">
            <div class="progress" id="progress"></div>
        </div>
        <p id="progress-text">Progress: 0%</p>
    </div>

    <!-- Historical Use Section -->
    <div class="container hidden" id="historical-use-section">
        <h2 class="section-title">Historical Electricity Use</h2>
        <p>Below is information about the Smith family's electricity use over the past 14 months.</p>
        <div class="info-display" id="historical-use-display"></div>
        <h3>Understanding Questions</h3>
        <div id="historical-understanding-questions"></div>
        <h3>Your Opinions</h3>
        <div id="historical-preference-questions"></div>
        <h3>Intention to Save Electricity</h3>
        <div id="historical-intention-question"></div>
        <button class="btn hidden" id="historical-next-btn">Next</button>
    </div>

    <!-- Neighbor Comparison Section -->
    <div class="container hidden" id="neighbor-section">
        <h2 class="section-title">Neighbor Comparison</h2>
        <p>Below is information comparing the Smith family's electricity use to that of their neighbors for the month of February 2012.</p>
        <div class="info-display" id="neighbor-display"></div>
        <h3>Understanding Questions</h3>
        <div id="neighbor-understanding-questions"></div>
        <h3>Your Opinions</h3>
        <div id="neighbor-preference-questions"></div>
        <h3>Intention to Save Electricity</h3>
        <div id="neighbor-intention-question"></div>
        <button class="btn hidden" id="neighbor-next-btn">Next</button>
    </div>

    <!-- Appliance Breakdown Section -->
    <div class="container hidden" id="appliance-section">
        <h2 class="section-title">Historical Electricity Use with Appliance Breakdown</h2>
        <p>Below is information about the Smith family's electricity use over the past 14 months, broken down by appliance type.</p>
        <div class="info-display" id="appliance-display"></div>
        <h3>Understanding Questions</h3>
        <div id="appliance-understanding-questions"></div>
        <h3>Your Opinions</h3>
        <div id="appliance-preference-questions"></div>
        <h3>Intention to Save Electricity</h3>
        <div id="appliance-intention-question"></div>
        <button class="btn hidden" id="appliance-next-btn">Next</button>
    </div>

    <!-- Energy Literacy Section -->
    <div class="container hidden" id="literacy-section">
        <h2 class="section-title">Energy Literacy Assessment</h2>
        <p>Please answer the following questions about energy use.</p>
        <div id="literacy-questions"></div>
        <button class="btn hidden" id="literacy-next-btn">See Results</button>
    </div>

    <!-- Results Section -->
    <div class="container hidden" id="results-section">
        <h2>Your Results</h2>
        <div class="results">
            <h3>Understanding Scores</h3>
            <p id="understanding-results"></p>
            <h3>Preference Ratings</h3>
            <p id="preference-results"></p>
            <h3>Intentions to Save Electricity</h3>
            <p id="intention-results"></p>
            <h3>Energy Literacy Score</h3>
            <p id="literacy-results"></p>
        </div>
        <h3>Study Findings</h3>
        <p>The original study found:</p>
        <ul>
            <li>Tables were the easiest format to understand for all types of electricity-use information.</li>
            <li>Historical use information was preferred the most, followed by appliance breakdown, then neighbor comparison.</li>
            <li>Intentions to save electricity were highest for historical use and appliance breakdown information.</li>
            <li>People with lower energy literacy understood all information less well.</li>
        </ul>
        <button class="btn" id="restart-btn">Restart Demo</button>
    </div>

    <script>
        // Global variables
        let selectedFormat = '';
        let currentSection = 'intro';
        const sections = ['intro', 'format', 'historical-use', 'neighbor', 'appliance', 'literacy', 'results'];
        let progress = 0;
        
        // Scores
        const scores = {
            understanding: {
                historical: 0,
                neighbor: 0,
                appliance: 0
            },
            preference: {
                historical: 0,
                neighbor: 0,
                appliance: 0
            },
            intention: {
                historical: 0,
                neighbor: 0,
                appliance: 0
            },
            literacy: 0
        };
        
        // Data for the Smith Family
        const electricityData = {
            historical: [
                { month: 'Jan 2011', kwh: 1600 },
                { month: 'Feb 2011', kwh: 1500 },
                { month: 'Mar 2011', kwh: 1300 },
                { month: 'Apr 2011', kwh: 1100 },
                { month: 'May 2011', kwh: 1000 },
                { month: 'Jun 2011', kwh: 1400 },
                { month: 'Jul 2011', kwh: 1800 },
                { month: 'Aug 2011', kwh: 1700 },
                { month: 'Sep 2011', kwh: 1200 },
                { month: 'Oct 2011', kwh: 900 },
                { month: 'Nov 2011', kwh: 1100 },
                { month: 'Dec 2011', kwh: 1400 },
                { month: 'Jan 2012', kwh: 1500 },
                { month: 'Feb 2012', kwh: 1400 }
            ],
            neighbor: [
                { range: '0-200', count: 1 },
                { range: '201-400', count: 5 },
                { range: '401-600', count: 7 },
                { range: '601-800', count: 10 },
                { range: '801-1000', count: 7 },
                { range: '1001-1200', count: 5 },
                { range: '1201-1400', count: 3 },
                { range: 'Smith Home', count: 1, kwh: 1400 }
            ],
            appliance: [
                { 
                    month: 'Jan 2011', 
                    total: 1600,
                    breakdown: {
                        'Space Heating': 650,
                        'Central A/C': 0,
                        'Lighting': 250,
                        'Kitchen Appliances': 300,
                        'Other Appliances': 400
                    }
                },
                { 
                    month: 'Feb 2011', 
                    total: 1500,
                    breakdown: {
                        'Space Heating': 600,
                        'Central A/C': 0,
                        'Lighting': 220,
                        'Kitchen Appliances': 280,
                        'Other Appliances': 400
                    }
                },
                { 
                    month: 'Mar 2011', 
                    total: 1300,
                    breakdown: {
                        'Space Heating': 400,
                        'Central A/C': 0,
                        'Lighting': 200,
                        'Kitchen Appliances': 300,
                        'Other Appliances': 400
                    }
                },
                { 
                    month: 'Apr 2011', 
                    total: 1100,
                    breakdown: {
                        'Space Heating': 200,
                        'Central A/C': 0,
                        'Lighting': 200,
                        'Kitchen Appliances': 300,
                        'Other Appliances': 400
                    }
                },
                { 
                    month: 'May 2011', 
                    total: 1000,
                    breakdown: {
                        'Space Heating': 0,
                        'Central A/C': 100,
                        'Lighting': 200,
                        'Kitchen Appliances': 300,
                        'Other Appliances': 400
                    }
                },
                { 
                    month: 'Jun 2011', 
                    total: 1400,
                    breakdown: {
                        'Space Heating': 0,
                        'Central A/C': 500,
                        'Lighting': 200,
                        'Kitchen Appliances': 300,
                        'Other Appliances': 400
                    }
                },
                { 
                    month: 'Jul 2011', 
                    total: 1800,
                    breakdown: {
                        'Space Heating': 0,
                        'Central A/C': 900,
                        'Lighting': 200,
                        'Kitchen Appliances': 300,
                        'Other Appliances': 400
                    }
                },
                { 
                    month: 'Aug 2011', 
                    total: 1700,
                    breakdown: {
                        'Space Heating': 0,
                        'Central A/C': 800,
                        'Lighting': 200,
                        'Kitchen Appliances': 300,
                        'Other Appliances': 400
                    }
                },
                { 
                    month: 'Sep 2011', 
                    total: 1200,
                    breakdown: {
                        'Space Heating': 0,
                        'Central A/C': 300,
                        'Lighting': 200,
                        'Kitchen Appliances': 300,
                        'Other Appliances': 400
                    }
                },
                { 
                    month: 'Oct 2011', 
                    total: 900,
                    breakdown: {
                        'Space Heating': 0,
                        'Central A/C': 0,
                        'Lighting': 200,
                        'Kitchen Appliances': 300,
                        'Other Appliances': 400
                    }
                },
                { 
                    month: 'Nov 2011', 
                    total: 1100,
                    breakdown: {
                        'Space Heating': 200,
                        'Central A/C': 0,
                        'Lighting': 200,
                        'Kitchen Appliances': 300,
                        'Other Appliances': 400
                    }
                },
                { 
                    month: 'Dec 2011', 
                    total: 1400,
                    breakdown: {
                        'Space Heating': 500,
                        'Central A/C': 0,
                        'Lighting': 200,
                        'Kitchen Appliances': 300,
                        'Other Appliances': 400
                    }
                },
                { 
                    month: 'Jan 2012', 
                    total: 1500,
                    breakdown: {
                        'Space Heating': 600,
                        'Central A/C': 0,
                        'Lighting': 200,
                        'Kitchen Appliances': 300,
                        'Other Appliances': 400
                    }
                },
                { 
                    month: 'Feb 2012', 
                    total: 1400,
                    breakdown: {
                        'Space Heating': 500,
                        'Central A/C': 0,
                        'Lighting': 200,
                        'Kitchen Appliances': 300,
                        'Other Appliances': 400
                    }
                }
            ]
        };
        
        // Understanding questions (true/false)
        const understandingQuestions = {
            historical: [
                {
                    question: "The highest electricity use was 1800kWh.",
                    answer: true,
                    type: "verbatim"
                },
                {
                    question: "The lowest electricity use was 700kWh.",
                    answer: false, // It's 900 kWh in October
                    type: "verbatim"
                },
                {
                    question: "Just looking at the winter months (Dec, Jan, Feb), the Smiths tend to use the most on electricity in February.",
                    answer: false, // They use more in January
                    type: "complex"
                },
                {
                    question: "The Smith's home used more electricity in February 2011 than February 2012.",
                    answer: true, // 1500 vs 1400
                    type: "complex"
                },
                {
                    question: "The Smith's home used the most electricity in August.",
                    answer: false, // Most was in July
                    type: "complex"
                },
                {
                    question: "The Smith's home used the most electricity in the summer months (Jun, Jul, Aug).",
                    answer: true,
                    type: "complex"
                },
                {
                    question: "Every month, the Smith's electricity use was above 600kWh.",
                    answer: true,
                    type: "verbatim"
                }
            ],
            neighbor: [
                {
                    question: "The Smith's neighbors vary in how much electricity they use.",
                    answer: true,
                    type: "complex"
                },
                {
                    question: "18 homes used less electricity than the Smith's home.",
                    answer: false, // All neighbors used less
                    type: "complex"
                },
                {
                    question: "The Smith's home used more electricity than most of their neighbors.",
                    answer: true,
                    type: "complex"
                },
                {
                    question: "The Smith's home should use less electricity to be closer to the neighborhood average.",
                    answer: true,
                    type: "complex"
                },
                {
                    question: "Most homes used more than 300kWh of electricity.",
                    answer: true,
                    type: "verbatim"
                },
                {
                    question: "There is a difference of about 696kWh between the home that used the most and the least electricity.",
                    answer: false, // Not the correct difference
                    type: "verbatim"
                },
                {
                    question: "The maximum amount of electricity used by the Smith's neighbors was about 279kWh.",
                    answer: false, // Highest neighbor category is 1201-1400
                    type: "verbatim"
                }
            ],
            appliance: [
                {
                    question: "In January 2011, the Smiths used the most electricity for space heating.",
                    answer: true,
                    type: "complex"
                },
                {
                    question: "In May 2011, the Smiths used the most electricity for running their \"other\" appliances.",
                    answer: true,
                    type: "complex"
                },
                {
                    question: "The Smith's home used less electricity in January 2011 than in January 2012.",
                    answer: false, // 1600 vs 1500
                    type: "complex"
                },
                {
                    question: "The Smith's use 300-400kWh of electricity a month for \"other\" appliances.",
                    answer: true,
                    type: "verbatim"
                },
                {
                    question: "The difference in usage for lighting and kitchen appliances is never more than 100kWh.",
                    answer: true,
                    type: "verbatim"
                },
                {
                    question: "The main reason why the Smith's electricity use changes from month-to-month is because of lighting.",
                    answer: false, // It's heating and cooling
                    type: "complex"
                },
                {
                    question: "Without heat or air-conditioning, the Smiths would probably use between 400-500kWh per month.",
                    answer: false, // They use about 900
                    type: "verbatim"
                }
            ]
        };
        
        // Preference questions (1-7 scale)
        const preferenceQuestions = [
            "How clear is this information?",
            "How easy is this information to understand?",
            "How much do you like the way this information was presented?",
            "How easy is this information to use?",
            "How much would you like it if this information were included in your electricity bill?",
            "How useful would it be if this information came with your electricity bill?",
            "How professional does this information seem?",
            "How much would you trust this information if it came with your electricity bill?",
            "How much more detail would you like to see if this information came with your electricity bill?",
            "How much would this information help you decide how to change your electricity use?"
        ];
        
        // Intention question (1-7 scale)
        const intentionQuestion = "How much does this information make you want to lower your electricity usage?";
        
        // Energy literacy questions
        const literacyQuestions = [
            {
                question: "The amount of ELECTRICAL ENERGY (ELECTRICITY) we use is measured in units called ...",
                options: [
                    "Kilowatt (kW)",
                    "Kilowatt-hours (kWh)",
                    "British Thermal Units (BTU)",
                    "Volts (V)",
                    "Horsepower (HP)"
                ],
                answer: 1
            },
            {
                question: "The amount of ENERGY consumed by an electrical appliance is equal to the power rating of the appliance (watts or kilowatts) ...",
                options: [
                    "Multiplied by the cost of electricity",
                    "Added to the cost of electricity",
                    "Multiplied by the time it's used",
                    "Divided by the time it's used",
                    "Added to the time it's used"
                ],
                answer: 2
            },
            {
                question: "When you turn on an incandescent light bulb, which of the following energy conversion takes place?",
                options: [
                    "Electrical energy to radient energy (light)",
                    "Chemical energy to radient energy (light)",
                    "Electrical energy to radient energy (light) and thermal energy (heat)",
                    "Chemical energy to radient energy (light) and thermal energy (heat)",
                    "Electrical energy to radient energy (light) and mechanical energy"
                ],
                answer: 2
            },
            {
                question: "The best reason to buy an ENERGY STARÂ® appliance is ...",
                options: [
                    "ENERGY STAR appliances are usually bigger",
                    "ENERGY STAR appliances cost more",
                    "ENERGY STAR appliances use less energy",
                    "ENERGY STAR appliances are more modern looking",
                    "ENERGY STAR appliances cost less"
                ],
                answer: 2
            },
            {
                question: "Which uses the MOST ENERGY in the average American home in one year?",
                options: [
                    "Refrigerating food and beverages",
                    "Washing and drying clothing",
                    "Heating and cooling rooms",
                    "Heating and cooling water",
                    "Lighting the home"
                ],
                answer: 2
            },
            {
                question: "Which of the following items uses the MOST ELECTRICITY in the average home in one year?",
                options: [
                    "Lights",
                    "Refrigerator",
                    "Telephone",
                    "Television",
                    "Computer"
                ],
                answer: 1
            },
            {
                question: "Which of the following sources provides most of the ELECTRICITY in the United States?",
                options: [
                    "Nuclear power",
                    "Burning petroleum",
                    "Burning coal",
                    "Solar energy",
                    "Water (hydro) power"
                ],
                answer: 2
            },
            {
                question: "Some people think that if we run out of fossil fuels we can just switch over to electric cars. What is wrong with this idea?",
                options: [
                    "Most electricity is currently produced from fossil fuels (coal, oil, natural gas)",
                    "Switching to electric cars will make unemployment rates go up",
                    "It has been proven that it is impossible to build electric cars in great quantities",
                    "You can't use electricity to operate a car",
                    "There is nothing wrong with this idea"
                ],
                answer: 0
            }
        ];
        
        // Event Listeners
        document.getElementById('start-btn').addEventListener('click', () => {
            showSection('format');
        });
        
        document.getElementById('table-btn').addEventListener('click', () => {
            selectedFormat = 'table';
            startExperiment();
        });
        
        document.getElementById('bar-btn').addEventListener('click', () => {
            selectedFormat = 'bar';
            startExperiment();
        });
        
        document.getElementById('icon-btn').addEventListener('click', () => {
            selectedFormat = 'icon';
            startExperiment();
        });
        
        document.getElementById('historical-next-btn').addEventListener('click', () => {
            calculateScores('historical');
            showSection('neighbor');
        });
        
        document.getElementById('neighbor-next-btn').addEventListener('click', () => {
            calculateScores('neighbor');
            showSection('appliance');
        });
        
        document.getElementById('appliance-next-btn').addEventListener('click', () => {
            calculateScores('appliance');
            showSection('literacy');
        });
        
        document.getElementById('literacy-next-btn').addEventListener('click', () => {
            calculateLiteracyScore();
            showSection('results');
        });
        
        document.getElementById('restart-btn').addEventListener('click', () => {
            resetDemo();
            showSection('intro');
        });
        
        // Functions
        function showSection(section) {
            // Hide all sections
            sections.forEach(s => {
                document.getElementById(`${s}-section`).classList.add('hidden');
            });
            
            // Show the current section
            document.getElementById(`${section}-section`).classList.remove('hidden');
            
            // Update progress
            if (section !== 'intro' && section !== 'format') {
                document.getElementById('progress-section').classList.remove('hidden');
                updateProgress(section);
            } else {
                document.getElementById('progress-section').classList.add('hidden');
            }
            
            currentSection = section;
        }
        
        function updateProgress(section) {
            const sectionIndices = {
                'historical-use': 0,
                'neighbor': 1,
                'appliance': 2,
                'literacy': 3,
                'results': 4
            };
            
            // Set progress based on current section
            if (section in sectionIndices) {
                progress = (sectionIndices[section] / 4) * 100;
            } else {
                progress = 0;
            }
            
            // Update progress bar
            document.getElementById('progress').style.width = `${progress}%`;
            document.getElementById('progress-text').textContent = `Progress: ${Math.round(progress)}%`;
        }
        
        function startExperiment() {
            // Show progress section
            document.getElementById('progress-section').classList.remove('hidden');
            
            // Generate displays based on selected format
            generateHistoricalDisplay();
            generateNeighborDisplay();
            generateApplianceDisplay();
            
            // Generate questions
            generateUnderstandingQuestions('historical');
            generatePreferenceQuestions('historical');
            generateIntentionQuestion('historical');
            
            generateUnderstandingQuestions('neighbor');
            generatePreferenceQuestions('neighbor');
            generateIntentionQuestion('neighbor');
            
            generateUnderstandingQuestions('appliance');
            generatePreferenceQuestions('appliance');
            generateIntentionQuestion('appliance');
            
            generateLiteracyQuestions();
            
            // Show historical use section
            showSection('historical-use');
        }
        
        function generateHistoricalDisplay() {
            const displayEl = document.getElementById('historical-use-display');
            
            if (selectedFormat === 'table') {
                // Generate table
                let tableHTML = `
                    <table>
                        <tr>
                            <th>Month</th>
                            <th>Electricity Use (kWh)</th>
                        </tr>
                `;
                
                electricityData.historical.forEach(month => {
                    tableHTML += `
                        <tr>
                            <td>${month.month}</td>
                            <td>${month.kwh}</td>
                        </tr>
                    `;
                });
                
                tableHTML += '</table>';
                displayEl.innerHTML = tableHTML;
            } else if (selectedFormat === 'bar') {
                // Generate bar graph
                displayEl.innerHTML = `<canvas id="historical-bar-chart" height="300"></canvas>`;
                
                const months = electricityData.historical.map(d => d.month);
                const values = electricityData.historical.map(d => d.kwh);
                
                const canvas = document.getElementById('historical-bar-chart');
                const ctx = canvas.getContext('2d');
                
                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Set dimensions
                const chartHeight = 250;
                const chartWidth = 700;
                const barWidth = chartWidth / months.length - 10;
                const maxValue = Math.max(...values);
                
                // Draw axes
                ctx.beginPath();
                ctx.moveTo(50, 20);
                ctx.lineTo(50, chartHeight + 20);
                ctx.lineTo(chartWidth + 50, chartHeight + 20);
                ctx.stroke();
                
                // Draw bars
                for (let i = 0; i < months.length; i++) {
                    const barHeight = (values[i] / maxValue) * chartHeight;
                    
                    ctx.fillStyle = '#3498db';
                    ctx.fillRect(i * (barWidth + 10) + 60, chartHeight - barHeight + 20, barWidth, barHeight);
                    
                    // Add x-axis labels
                    ctx.fillStyle = '#000';
                    ctx.font = '10px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(months[i], i * (barWidth + 10) + 60 + barWidth/2, chartHeight + 40);
                }
                
                // Add y-axis labels
                ctx.textAlign = 'right';
                for (let i = 0; i <= 5; i++) {
                    const value = Math.round(i * maxValue / 5);
                    const y = chartHeight - (i * chartHeight / 5) + 20;
                    ctx.fillText(value, 45, y + 5);
                }
                
                // Add title
                ctx.textAlign = 'center';
                ctx.font = '14px Arial';
                ctx.fillText('Monthly Electricity Use (kWh)', chartWidth / 2 + 50, 15);
            } else if (selectedFormat === 'icon') {
                // Generate icon graph
                let iconHTML = '<div style="margin-bottom: 10px;">Monthly Electricity Use (kWh)</div>';
                
                electricityData.historical.forEach(month => {
                    const normalizedValue = month.kwh / 100; // Scale by 100 for display
                    
                    iconHTML += `
                        <div style="margin-bottom: 15px;">
                            <div style="margin-bottom: 5px;">${month.month}: ${month.kwh} kWh</div>
                            <div class="icon-grid">
                    `;
                    
                    for (let i = 0; i < normalizedValue; i++) {
                        iconHTML += `<div class="icon" title="100 kWh"></div>`;
                    }
                    
                    iconHTML += `
                            </div>
                        </div>
                    `;
                });
                
                displayEl.innerHTML = iconHTML;
            }
        }
        
        function generateNeighborDisplay() {
            const displayEl = document.getElementById('neighbor-display');
            
            if (selectedFormat === 'table') {
                // Generate table
                let tableHTML = `
                    <table>
                        <tr>
                            <th>Electricity Use Range (kWh)</th>
                            <th>Number of Homes</th>
                        </tr>
                `;
                
                electricityData.neighbor.forEach(range => {
                    tableHTML += `
                        <tr>
                            <td>${range.range}</td>
                            <td>${range.count}</td>
                        </tr>
                    `;
                });
                
                tableHTML += '</table>';
                displayEl.innerHTML = tableHTML;
            } else if (selectedFormat === 'bar') {
                // Generate bar graph (histogram)
                displayEl.innerHTML = `<canvas id="neighbor-bar-chart" height="350"></canvas>`;
                
                const ranges = electricityData.neighbor.map(d => d.range);
                const counts = electricityData.neighbor.map(d => d.count);
                
                const canvas = document.getElementById('neighbor-bar-chart');
                const ctx = canvas.getContext('2d');
                
                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Set dimensions
                const chartHeight = 250;
                const chartWidth = 700;
                const barWidth = chartWidth / ranges.length - 10;
                const maxCount = Math.max(...counts);
                
                // Draw axes
                ctx.beginPath();
                ctx.moveTo(50, 20);
                ctx.lineTo(50, chartHeight + 20);
                ctx.lineTo(chartWidth + 50, chartHeight + 20);
                ctx.stroke();
                
                // Draw bars
                for (let i = 0; i < ranges.length; i++) {
                    const barHeight = (counts[i] / maxCount) * chartHeight;
                    
                    // Make Smith home bar red
                    ctx.fillStyle = ranges[i] === 'Smith Home' ? '#e74c3c' : '#3498db';
                    ctx.fillRect(i * (barWidth + 10) + 60, chartHeight - barHeight + 20, barWidth, barHeight);
                    
                    // Add x-axis labels
                    ctx.fillStyle = '#000';
                    ctx.font = '10px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(ranges[i], i * (barWidth + 10) + 60 + barWidth/2, chartHeight + 40);
                }
                
                // Add y-axis labels
                ctx.textAlign = 'right';
                for (let i = 0; i <= 5; i++) {
                    const value = Math.round(i * maxCount / 5);
                    const y = chartHeight - (i * chartHeight / 5) + 20;
                    ctx.fillText(value, 45, y + 5);
                }
                
                // Add title
                ctx.textAlign = 'center';
                ctx.font = '14px Arial';
                ctx.fillText('Number of Homes by Electricity Use Range', chartWidth / 2 + 50, 15);
            } else if (selectedFormat === 'icon') {
                // Generate icon graph (histogram with icons)
                let iconHTML = `
                    <div style="margin-bottom: 20px;">Number of Homes by Electricity Use Range (February 2012)</div>
                    <div style="display: flex; height: 300px; align-items: flex-end;">
                `;
                
                electricityData.neighbor.forEach(range => {
                    const normalizedHeight = (range.count / Math.max(...electricityData.neighbor.map(d => d.count))) * 250;
                    
                    iconHTML += `
                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center; margin: 0 5px;">
                            <div style="height: ${normalizedHeight}px; width: 100%; display: flex; flex-direction: column-reverse;">
                    `;
                    
                    for (let i = 0; i < range.count; i++) {
                        iconHTML += `
                            <div style="height: 20px; width: 100%; background-color: ${range.range === 'Smith Home' ? '#e74c3c' : '#3498db'}; 
                            margin: 2px 0; display: flex; justify-content: center; align-items: center;">
                                <span style="color: white; font-size: 10px;">ð </span>
                            </div>
                        `;
                    }
                    
                    iconHTML += `
                            </div>
                            <div style="margin-top: 10px; font-size: 10px; text-align: center;">${range.range}</div>
                        </div>
                    `;
                });
                
                iconHTML += '</div>';
                displayEl.innerHTML = iconHTML;
            }
        }
        
        function generateApplianceDisplay() {
            const displayEl = document.getElementById('appliance-display');
            
            if (selectedFormat === 'table') {
                // Generate table
                let tableHTML = `
                    <table>
                        <tr>
                            <th>Month</th>
                            <th>Space Heating</th>
                            <th>Central A/C</th>
                            <th>Lighting</th>
                            <th>Kitchen Appliances</th>
                            <th>Other Appliances</th>
                            <th>Total (kWh)</th>
                        </tr>
                `;
                
                electricityData.appliance.forEach(month => {
                    tableHTML += `
                        <tr>
                            <td>${month.month}</td>
                            <td>${month.breakdown['Space Heating']}</td>
                            <td>${month.breakdown['Central A/C']}</td>
                            <td>${month.breakdown['Lighting']}</td>
                            <td>${month.breakdown['Kitchen Appliances']}</td>
                            <td>${month.breakdown['Other Appliances']}</td>
                            <td>${month.total}</td>
                        </tr>
                    `;
                });
                
                tableHTML += '</table>';
                displayEl.innerHTML = tableHTML;
            } else if (selectedFormat === 'bar') {
                // Generate stacked bar graph
                let barHTML = `<div style="margin-bottom: 20px;">Monthly Electricity Use by Appliance Type (kWh)</div>`;
                
                // Define colors for each category
                const colors = {
                    'Space Heating': '#e74c3c', 
                    'Central A/C': '#3498db',
                    'Lighting': '#f1c40f',
                    'Kitchen Appliances': '#2ecc71',
                    'Other Appliances': '#9b59b6'
                };
                
                // Add legend
                barHTML += `<div style="display: flex; margin-bottom: 20px;">`;
                Object.entries(colors).forEach(([category, color]) => {
                    barHTML += `
                        <div style="display: flex; align-items: center; margin-right: 15px;">
                            <div style="width: 15px; height: 15px; background-color: ${color}; margin-right: 5px;"></div>
                            <div style="font-size: 12px;">${category}</div>
                        </div>
                    `;
                });
                barHTML += `</div>`;
                
                // Add bars
                electricityData.appliance.forEach(month => {
                    barHTML += `
                        <div style="margin-bottom: 5px;">
                            <div style="display: flex; align-items: center;">
                                <div style="width: 80px; font-size: 12px;">${month.month}</div>
                                <div class="stacked-bar" style="width: calc(100% - 80px);">
                    `;
                    
                    // Calculate percentage width for each segment
                    const categories = Object.keys(month.breakdown);
                    categories.forEach(category => {
                        const percentage = (month.breakdown[category] / month.total) * 100;
                        barHTML += `
                            <div class="bar-segment" style="width: ${percentage}%; background-color: ${colors[category]};" 
                                title="${category}: ${month.breakdown[category]} kWh"></div>
                        `;
                    });
                    
                    barHTML += `
                                </div>
                            </div>
                            <div style="font-size: 12px; text-align: right;">Total: ${month.total} kWh</div>
                        </div>
                    `;
                });
                
                displayEl.innerHTML = barHTML;
            } else if (selectedFormat === 'icon') {
                // Generate icon graph for appliance breakdown
                let iconHTML = `<div style="margin-bottom: 20px;">Monthly Electricity Use by Appliance Type (kWh)</div>`;
                
                // Define colors for each category
                const colors = {
                    'Space Heating': '#e74c3c', 
                    'Central A/C': '#3498db',
                    'Lighting': '#f1c40f',
                    'Kitchen Appliances': '#2ecc71',
                    'Other Appliances': '#9b59b6'
                };
                
                // Add legend
                iconHTML += `<div style="display: flex; margin-bottom: 20px;">`;
                Object.entries(colors).forEach(([category, color]) => {
                    iconHTML += `
                        <div style="display: flex; align-items: center; margin-right: 15px;">
                            <div style="width: 15px; height: 15px; background-color: ${color}; margin-right: 5px;"></div>
                            <div style="font-size: 12px;">${category}</div>
                        </div>
                    `;
                });
                iconHTML += `</div>`;
                
                // For each month
                electricityData.appliance.forEach(month => {
                    iconHTML += `<div style="margin-bottom: 30px;">`;
                    iconHTML += `<div style="font-weight: bold; margin-bottom: 5px;">${month.month} (Total: ${month.total} kWh)</div>`;
                    
                    // For each appliance category
                    Object.entries(month.breakdown).forEach(([category, value]) => {
                        if (value > 0) {
                            const iconCount = Math.round(value / 50); // 1 icon = 50 kWh
                            
                            iconHTML += `
                                <div style="margin-bottom: 10px;">
                                    <div style="font-size: 12px; margin-bottom: 2px;">${category}: ${value} kWh</div>
                                    <div style="display: flex; flex-wrap: wrap;">
                            `;
                            
                            for (let i = 0; i < iconCount; i++) {
                                iconHTML += `
                                    <div style="width: 10px; height: 10px; background-color: ${colors[category]}; 
                                    margin: 2px;" title="${category}: 50 kWh"></div>
                                `;
                            }
                            
                            iconHTML += `
                                    </div>
                                </div>
                            `;
                        }
                    });
                    
                    iconHTML += `</div>`;
                });
                
                displayEl.innerHTML = iconHTML;
            }
        }
        
        function generateUnderstandingQuestions(section) {
            const questionsEl = document.getElementById(`${section}-understanding-questions`);
            let questionsHTML = '';
            
            understandingQuestions[section].forEach((q, i) => {
                questionsHTML += `
                    <div class="question">
                        <div>${q.question}</div>
                        <div class="options">
                            <label>
                                <input type="radio" name="${section}_q${i}" value="true"> True
                            </label>
                            <label>
                                <input type="radio" name="${section}_q${i}" value="false"> False
                            </label>
                        </div>
                    </div>
                `;
            });
            
            questionsEl.innerHTML = questionsHTML;
        }
        
        function generatePreferenceQuestions(section) {
            const questionsEl = document.getElementById(`${section}-preference-questions`);
            let questionsHTML = '';
            
            preferenceQuestions.forEach((q, i) => {
                questionsHTML += `
                    <div class="question">
                        <div>${q}</div>
                        <div class="likert-scale">
                `;
                
                for (let j = 1; j <= 7; j++) {
                    questionsHTML += `
                        <div class="likert-option">
                            <input type="radio" name="${section}_pref_q${i}" value="${j}" id="${section}_pref_q${i}_${j}">
                            <label for="${section}_pref_q${i}_${j}">${j}</label>
                            ${j === 1 ? '<div>Not at all</div>' : ''}
                            ${j === 7 ? '<div>Very much</div>' : ''}
                        </div>
                    `;
                }
                
                questionsHTML += `
                        </div>
                    </div>
                `;
            });
            
            questionsEl.innerHTML = questionsHTML;
        }
        
        function generateIntentionQuestion(section) {
            const questionEl = document.getElementById(`${section}-intention-question`);
            let questionHTML = `
                <div class="question">
                    <div>${intentionQuestion}</div>
                    <div class="likert-scale">
            `;
            
            for (let j = 1; j <= 7; j++) {
                questionHTML += `
                    <div class="likert-option">
                        <input type="radio" name="${section}_intention" value="${j}" id="${section}_intention_${j}">
                        <label for="${section}_intention_${j}">${j}</label>
                        ${j === 1 ? '<div>Not at all</div>' : ''}
                        ${j === 7 ? '<div>A lot</div>' : ''}
                    </div>
                `;
            }
            
            questionHTML += `
                    </div>
                </div>
            `;
            
            questionEl.innerHTML = questionHTML;
            
            // Add event listener to show next button when answered
            const intentionRadios = document.querySelectorAll(`input[name="${section}_intention"]`);
            intentionRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    document.getElementById(`${section}-next-btn`).classList.remove('hidden');
                });
            });
        }
        
        function generateLiteracyQuestions() {
            const questionsEl = document.getElementById('literacy-questions');
            let questionsHTML = '';
            
            literacyQuestions.forEach((q, i) => {
                questionsHTML += `
                    <div class="question">
                        <div>${q.question}</div>
                        <div class="options">
                `;
                
                q.options.forEach((option, j) => {
                    questionsHTML += `
                        <label>
                            <input type="radio" name="literacy_q${i}" value="${j}"> ${option}
                        </label>
                    `;
                });
                
                questionsHTML += `
                        </div>
                    </div>
                `;
            });
            
            questionsEl.innerHTML = questionsHTML;
            
            // Add event listener to show next button when all questions are answered
            const literacyRadios = document.querySelectorAll('input[name^="literacy_q"]');
            literacyRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    checkLiteracyCompletion();
                });
            });
        }
        
        function checkLiteracyCompletion() {
            const allAnswered = literacyQuestions.every((_, i) => {
                return document.querySelector(`input[name="literacy_q${i}"]:checked`) !== null;
            });
            
            if (allAnswered) {
                document.getElementById('literacy-next-btn').classList.remove('hidden');
            }
        }
        
        function calculateScores(section) {
            // Calculate understanding score
            let correctAnswers = 0;
            understandingQuestions[section].forEach((q, i) => {
                const selectedAnswer = document.querySelector(`input[name="${section}_q${i}"]:checked`);
                if (selectedAnswer && ((selectedAnswer.value === 'true' && q.answer === true) || (selectedAnswer.value === 'false' && q.answer === false))) {
                    correctAnswers++;
                }
            });
            scores.understanding[section] = correctAnswers / understandingQuestions[section].length;
            
            // Calculate preference score
            let preferenceSum = 0;
            let preferenceCount = 0;
            preferenceQuestions.forEach((_, i) => {
                const selectedRating = document.querySelector(`input[name="${section}_pref_q${i}"]:checked`);
                if (selectedRating) {
                    preferenceSum += parseInt(selectedRating.value);
                    preferenceCount++;
                }
            });
            scores.preference[section] = preferenceCount > 0 ? preferenceSum / preferenceCount : 0;
            
            // Get intention score
            const intentionRating = document.querySelector(`input[name="${section}_intention"]:checked`);
            scores.intention[section] = intentionRating ? parseInt(intentionRating.value) : 0;
        }
        
        function calculateLiteracyScore() {
            let correctAnswers = 0;
            literacyQuestions.forEach((q, i) => {
                const selectedAnswer = document.querySelector(`input[name="literacy_q${i}"]:checked`);
                if (selectedAnswer && parseInt(selectedAnswer.value) === q.answer) {
                    correctAnswers++;
                }
            });
            scores.literacy = correctAnswers / literacyQuestions.length;
        }
        
        function displayResults() {
            // Understanding results
            const understandingEl = document.getElementById('understanding-results');
            understandingEl.innerHTML = `
                <p>Your understanding scores (% correct):</p>
                <ul>
                    <li>Historical Use: ${Math.round(scores.understanding.historical * 100)}%</li>
                    <li>Neighbor Comparison: ${Math.round(scores.understanding.neighbor * 100)}%</li>
                    <li>Appliance Breakdown: ${Math.round(scores.understanding.appliance * 100)}%</li>
                </ul>
            `;
            
            // Preference results
            const preferenceEl = document.getElementById('preference-results');
            preferenceEl.innerHTML = `
                <p>Your preference ratings (1-7 scale):</p>
                <ul>
                    <li>Historical Use: ${scores.preference.historical.toFixed(1)}</li>
                    <li>Neighbor Comparison: ${scores.preference.neighbor.toFixed(1)}</li>
                    <li>Appliance Breakdown: ${scores.preference.appliance.toFixed(1)}</li>
                </ul>
            `;
            
            // Intention results
            const intentionEl = document.getElementById('intention-results');
            intentionEl.innerHTML = `
                <p>Your intentions to save electricity (1-7 scale):</p>
                <ul>
                    <li>Historical Use: ${scores.intention.historical}</li>
                    <li>Neighbor Comparison: ${scores.intention.neighbor}</li>
                    <li>Appliance Breakdown: ${scores.intention.appliance}</li>
                </ul>
            `;
            
            // Literacy results
            const literacyEl = document.getElementById('literacy-results');
            literacyEl.innerHTML = `
                <p>Your energy literacy score: ${Math.round(scores.literacy * 100)}%</p>
            `;
        }
        
        function resetDemo() {
            // Reset scores
            Object.keys(scores.understanding).forEach(key => {
                scores.understanding[key] = 0;
                scores.preference[key] = 0;
                scores.intention[key] = 0;
            });
            scores.literacy = 0;
            
            // Reset progress
            progress = 0;
            document.getElementById('progress').style.width = '0%';
            document.getElementById('progress-text').textContent = 'Progress: 0%';
            
            // Reset format selection
            selectedFormat = '';
            
            // Hide next buttons
            document.getElementById('historical-next-btn').classList.add('hidden');
            document.getElementById('neighbor-next-btn').classList.add('hidden');
            document.getElementById('appliance-next-btn').classList.add('hidden');
            document.getElementById('literacy-next-btn').classList.add('hidden');
        }
        
        // Wait for the window to load, then display results
        window.addEventListener('load', function() {
            document.getElementById('results-section').addEventListener('DOMNodeInserted', function() {
                displayResults();
            });
        });
    </script>


</body></html>