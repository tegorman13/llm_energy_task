<!DOCTYPE html><html lang="en"><head><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energy Reduction Planning Dashboard</title>
    <style>
        :root {
            --primary-color: #2c6e49;
            --secondary-color: #4c956c;
            --tertiary-color: #d8f3dc;
            --accent-color: #f77f00;
            --text-color: #333;
            --bg-color: #f9f9f9;
            --card-bg: #fff;
            --border-color: #ddd;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
        }
        
        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px;
            border-radius: 5px 5px 0 0;
            margin-bottom: 0;
        }
        
        header h1 {
            margin: 0;
            font-size: 1.8rem;
        }
        
        /* Tab Navigation */
        .tab-navigation {
            background-color: var(--secondary-color);
            margin-bottom: 20px;
        }
        
        .tab-navigation ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            margin: 0;
            padding: 0;
        }
        
        .tab-item {
            padding: 12px 20px;
            cursor: pointer;
            color: white;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        
        .tab-item:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .tab-item.active {
            background-color: var(--tertiary-color);
            color: var(--primary-color);
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Card styles */
        .card {
            background-color: var(--card-bg);
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        /* Utility classes */
        .mb-20 {
            margin-bottom: 20px;
        }
        
        .text-center {
            text-align: center;
        }
        
        /* Chat interface */
        .chat-container {
            border: 1px solid var(--border-color);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .chat-messages {
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
            background-color: #f9f9f9;
        }
        
        .message {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 18px;
            max-width: 80%;
        }
        
        .user-message {
            background-color: var(--secondary-color);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }
        
        .ai-message {
            background-color: #e9e9e9;
            color: var(--text-color);
            border-bottom-left-radius: 5px;
        }
        
        .chat-input {
            display: flex;
            padding: 10px;
            background-color: white;
            border-top: 1px solid var(--border-color);
        }
        
        .chat-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
        }
        
        .chat-input button {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            margin-left: 10px;
            cursor: pointer;
        }
        
        /* Study 1 specific styles */
        .experiment-container {
            margin-top: 20px;
        }
        
        .row {
            display: flex;
            flex-wrap: wrap;
            margin: -10px;
        }
        
        .col-md-6 {
            flex: 1;
            min-width: 300px;
            padding: 10px;
        }
        
        .energy-breakdown {
            margin-top: 10px;
        }
        
        .breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        
        .goal-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }
        
        .goal-options label {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .goal-options span {
            font-weight: bold;
        }
        
        .plan-container {
            margin-top: 15px;
        }
        
        #plan-items {
            min-height: 100px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            padding: 10px;
            margin-bottom: 10px;
            background-color: #f9f9f9;
        }
        
        .plan-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid #eee;
        }
        
        .plan-item button {
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 3px;
            padding: 3px 8px;
            cursor: pointer;
        }
        
        .plan-input {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        #plan-action-input {
            flex: 3;
            padding: 8px;
        }
        
        #plan-savings-input {
            flex: 1;
            padding: 8px;
        }
        
        #add-to-plan {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .plan-summary {
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
        }
        
        .progress-bar {
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--accent-color);
            transition: width 0.3s ease;
        }
        
        .query-suggestions {
            margin-top: 15px;
        }
        
        .suggestion-btn {
            background-color: #e0e0e0;
            border: none;
            padding: 5px 10px;
            margin: 5px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .suggestion-btn:hover {
            background-color: #d0d0d0;
        }
        
        .survey-container {
            margin-top: 15px;
        }
        
        .survey-question {
            margin-bottom: 20px;
        }
        
        .survey-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 8px;
        }
        
        .survey-option label {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        #check-answers {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        #survey-results {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }
        
        .result-correct {
            background-color: #d4edda;
            color: #155724;
        }
        
        .result-incorrect {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        /* Study 2 specific styles */
        .study2-controls {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .support-level-selector, .household-selector {
            flex: 1;
            min-width: 250px;
        }
        
        .support-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }
        
        .support-options label {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .actions-container {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .actions-filter {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .action-item {
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: #f9f9f9;
            cursor: pointer;
        }
        
        .action-item:hover {
            background-color: #f0f0f0;
        }
        
        .action-details {
            font-size: 0.9em;
            color: #666;
        }
        
        .action-savings {
            font-weight: bold;
            color: #28a745;
        }
        
        .questionnaire-tabs {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .questionnaire-tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f0f0f0;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        
        .questionnaire-tab.active {
            background-color: var(--accent-color);
            color: white;
        }
        
        .questionnaire-panel {
            display: none;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 0 0 5px 5px;
        }
        
        .questionnaire-panel.active {
            display: block;
        }
        
        /* Background tabs styles */
        .profile-card {
            border-left: 5px solid var(--primary-color);
        }
        
        .breakdown-bar {
            display: flex;
            height: 30px;
            width: 100%;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .breakdown-segment {
            height: 100%;
        }
        
        .heating-cooling { background-color: #FF5252; }
        .water-heating { background-color: #2196F3; }
        .lighting { background-color: #FFEB3B; }
        .refrigeration { background-color: #4CAF50; }
        .electronics-appliances { background-color: #9C27B0; }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9em;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
        }
        
        .actions-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .actions-table th, .actions-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        .actions-table th {
            background-color: var(--primary-color);
            color: white;
            position: sticky;
            top: 0;
        }
        
        .actions-table tr:nth-child(even) {
            background-color: #f5f5f5;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .tab-navigation ul {
                flex-direction: column;
            }
            
            .tab-item {
                width: 100%;
                text-align: center;
            }
            
            .col-md-6 {
                flex: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <header>
            <h1>Energy Reduction Planning Research Dashboard</h1>
        </header>
        
        <nav class="tab-navigation">
            <ul>
                <li class="tab-item active" data-tab="home">Dashboard Home</li>
                <li class="tab-item" data-tab="study1">Study 1: LLM as Information Source</li>
                <li class="tab-item" data-tab="study2">Study 2: Structured LLM Support</li>
                <li class="tab-item" data-tab="background-materials">Background: Materials &amp; Hypotheses</li>
                <li class="tab-item" data-tab="background-profiles">Background: Household Profiles</li>
                <li class="tab-item" data-tab="background-actions">Background: Energy Actions</li>
            </ul>
        </nav>
        
        <main class="content-area">
            <!-- Home tab content -->
            <section id="home" class="tab-content active">
                <h2>Welcome to the Energy Reduction Planning Research Dashboard</h2>
                <p>This interactive dashboard demonstrates experimental tasks for studying how people create energy reduction plans with Large Language Model (LLM) assistance.</p>
                
                <div class="card mb-20">
                    <h3>Dashboard Overview</h3>
                    <p>This dashboard includes interactive demos of two experimental studies:</p>
                    <ul>
                        <li><strong>Study 1: LLM as Information Source</strong> - Explores how people use an LLM to query specific energy-saving information while creating a plan.</li>
                        <li><strong>Study 2: Structured LLM Support</strong> - Examines how different levels of LLM guidance influence planning quality and user experience.</li>
                    </ul>
                    <p>You can also explore background materials, household profiles, and the energy action database used in these studies.</p>
                </div>
                
                <div class="card">
                    <h3>Research Context</h3>
                    <p>Creating effective household energy reduction plans is challenging due to:</p>
                    <ul>
                        <li>Limited human knowledge about actual energy consumption of different appliances</li>
                        <li>Cognitive biases in estimating energy usage (overestimating visible devices, underestimating major consumers like heating)</li>
                        <li>Difficulty in quantifying and aggregating potential savings across multiple actions</li>
                    </ul>
                    <p>These studies investigate how LLMs might help overcome these barriers by providing accurate information, guidance, or draft plans.</p>
                    
                    <p>Click on the tabs above to navigate between different sections of the dashboard.</p>
                </div>
            </section>
            
            <!-- Study 1 tab content -->
            <section id="study1" class="tab-content">
                <h2>Study 1: LLM as Information Source</h2>
                
                <div class="card mb-20">
                    <h3>Task Overview</h3>
                    <p>In this study, participants create an energy reduction plan while using an LLM as a reactive information source. The LLM provides specific energy-saving information when queried but does not suggest actions or structure the plan.</p>
                </div>
                
                <div class="experiment-container">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-20">
                                <h3>Household Profile</h3>
                                <div id="profile-display">
                                    <h4>Small Apartment, Moderate Climate</h4>
                                    <p>2-bedroom apartment, 2 occupants, moderate climate zone</p>
                                    <p><strong>Annual Electricity Use:</strong> 8,500 kWh</p>
                                    <p><strong>Monthly Cost:</strong> $110</p>
                                    
                                    <h4>Energy Breakdown:</h4>
                                    <div class="energy-breakdown">
                                        <div class="breakdown-item">
                                            <span>Heating/Cooling:</span>
                                            <span>25%</span>
                                        </div>
                                        <div class="breakdown-item">
                                            <span>Water Heating:</span>
                                            <span>15%</span>
                                        </div>
                                        <div class="breakdown-item">
                                            <span>Lighting:</span>
                                            <span>10%</span>
                                        </div>
                                        <div class="breakdown-item">
                                            <span>Refrigeration:</span>
                                            <span>8%</span>
                                        </div>
                                        <div class="breakdown-item">
                                            <span>Electronics/Appliances:</span>
                                            <span>42%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mb-20">
                                <h3>Energy Reduction Goal</h3>
                                <div class="goal-options">
                                    <label>
                                        <input type="radio" name="goal-format" value="kwh" checked="">
                                        <span>kWh Format:</span> Reduce annual electricity use by 850 kWh (10%)
                                    </label>
                                    <label>
                                        <input type="radio" name="goal-format" value="percent">
                                        <span>Percentage Format:</span> Reduce annual electricity use by 10%
                                    </label>
                                    <label>
                                        <input type="radio" name="goal-format" value="dollars">
                                        <span>Dollar Format:</span> Reduce annual electricity bill by $110
                                    </label>
                                </div>
                            </div>
                            
                            <div class="card mb-20">
                                <h3>Your Energy-Saving Plan</h3>
                                <p>List the actions you would take to meet your energy reduction goal:</p>
                                <div class="plan-container">
                                    <div id="plan-items">
                                        <!-- Plan items will be added here -->
                                    </div>
                                    
                                    <div class="plan-input">
                                        <input type="text" id="plan-action-input" placeholder="Enter an action...">
                                        <input type="number" id="plan-savings-input" placeholder="kWh saved">
                                        <button id="add-to-plan">Add to Plan</button>
                                    </div>
                                    
                                    <div class="plan-summary">
                                        <p>Total Savings: <span id="total-savings">0</span> kWh</p>
                                        <p>Progress to Goal: <span id="goal-progress">0</span>%</p>
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 0%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card mb-20">
                                <h3>Ask the Energy Assistant</h3>
                                <p>Ask about specific energy-saving actions or information to help with your plan:</p>
                                
                                <div class="chat-container">
                                    <div class="chat-messages" id="chat-messages">
                                        <div class="message ai-message">
                                            Hello! I can provide information about specific energy-saving actions. For example, you can ask "How much energy does replacing incandescent bulbs with LEDs save?" or "What is vampire power?"
                                        </div>
                                    </div>
                                    
                                    <div class="chat-input">
                                        <input type="text" id="chat-input" placeholder="Ask about an energy-saving action...">
                                        <button id="send-message">Ask</button>
                                    </div>
                                </div>
                                
                                <div class="query-suggestions">
                                    <h4>Example Queries:</h4>
                                    <button class="suggestion-btn" data-query="How much energy does replacing 5 bulbs with LEDs save?">LED bulbs savings</button>
                                    <button class="suggestion-btn" data-query="How much energy does lowering thermostat by 2 degrees save?">Thermostat adjustment</button>
                                    <button class="suggestion-btn" data-query="What is vampire power?">Vampire power info</button>
                                    <button class="suggestion-btn" data-query="How much energy does washing clothes in cold water save?">Cold water washing</button>
                                </div>
                            </div>
                            
                            <div class="card">
                                <h3>Energy Literacy Questions</h3>
                                <p>Test your knowledge about household energy use:</p>
                                
                                <div class="survey-container" id="energy-literacy-questions">
                                    <div class="survey-question">
                                        <p><strong>Q1:</strong> Which of the following typically uses the MOST energy in an average U.S. home?</p>
                                        <div class="survey-options">
                                            <label>
                                                <input type="radio" name="q0" value="Lighting">
                                                Lighting
                                            </label>
                                            <label>
                                                <input type="radio" name="q0" value="Refrigerator">
                                                Refrigerator
                                            </label>
                                            <label>
                                                <input type="radio" name="q0" value="Water Heating">
                                                Water Heating
                                            </label>
                                            <label>
                                                <input type="radio" name="q0" value="Television">
                                                Television
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="survey-question">
                                        <p><strong>Q2:</strong> How many times more energy does a clothes dryer use compared to a ceiling fan (per hour of operation)?</p>
                                        <div class="survey-options">
                                            <label>
                                                <input type="radio" name="q1" value="About 2 times more">
                                                About 2 times more
                                            </label>
                                            <label>
                                                <input type="radio" name="q1" value="About 10 times more">
                                                About 10 times more
                                            </label>
                                            <label>
                                                <input type="radio" name="q1" value="About 40 times more">
                                                About 40 times more
                                            </label>
                                            <label>
                                                <input type="radio" name="q1" value="About 100 times more">
                                                About 100 times more
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="survey-question">
                                        <p><strong>Q3:</strong> Which action saves more energy?</p>
                                        <div class="survey-options">
                                            <label>
                                                <input type="radio" name="q2" value="Turning off a light bulb for 1 hour that's been on">
                                                Turning off a light bulb for 1 hour that's been on
                                            </label>
                                            <label>
                                                <input type="radio" name="q2" value="Turning off 10 light bulbs for 6 minutes that have been on">
                                                Turning off 10 light bulbs for 6 minutes that have been on
                                            </label>
                                            <label>
                                                <input type="radio" name="q2" value="Both save the same amount of energy">
                                                Both save the same amount of energy
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <button id="check-answers">Check Answers</button>
                                <div id="survey-results"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Study 2 tab content -->
            <section id="study2" class="tab-content">
                <h2>Study 2: Structured LLM Support</h2>
                
                <div class="card mb-20">
                    <h3>Task Overview</h3>
                    <p>In this study, participants create an energy reduction plan with different levels of structural support from an LLM. This demo showcases the various support conditions and how they influence the planning process.</p>
                </div>
                
                <div class="experiment-container">
                    <div class="study2-controls">
                        <div class="support-level-selector">
                            <h3>Select LLM Support Level:</h3>
                            <div class="support-options">
                                <label>
                                    <input type="radio" name="support-level" value="control" checked="">
                                    <span>Control (No LLM)</span>
                                </label>
                                <label>
                                    <input type="radio" name="support-level" value="information">
                                    <span>LLM as Information Source</span>
                                </label>
                                <label>
                                    <input type="radio" name="support-level" value="structured">
                                    <span>LLM as Structured Prompter</span>
                                </label>
                                <label>
                                    <input type="radio" name="support-level" value="draft">
                                    <span>LLM Drafts Plan</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="household-selector">
                            <h3>Select Household Profile:</h3>
                            <select id="household-profile">
                                <option value="1">Small Apartment, Moderate Climate</option>
                                <option value="2">Large Home, Cold Climate</option>
                                <option value="3">Medium Home, Hot Climate</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-20">
                                <h3>Household Profile</h3>
                                <div id="study2-profile-display">
                                    <!-- Will be populated based on selection -->
                                </div>
                            </div>
                            
                            <div class="card mb-20">
                                <h3>Available Energy-Saving Actions</h3>
                                <div class="actions-container">
                                    <div class="actions-filter">
                                        <label>Filter by category:</label>
                                        <select id="action-category-filter">
                                            <option value="all">All Categories</option>
                                            <option value="Lighting">Lighting</option>
                                            <option value="Heating/Cooling">Heating/Cooling</option>
                                            <option value="Water Heating">Water Heating</option>
                                            <option value="Appliances/Electronics">Appliances/Electronics</option>
                                        </select>
                                    </div>
                                    
                                    <div id="available-actions">
                                        <!-- Will be populated with actions -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card mb-20">
                                <h3>Planning Interface</h3>
                                <div class="planning-container">
                                    <div class="goal-display">
                                        <p><strong>Your Goal:</strong> Reduce annual electricity use by <span id="reduction-goal">850</span> kWh (10% of household usage)</p>
                                    </div>
                                    
                                    <div class="planning-interface" id="planning-interface">
                                        <!-- Will be populated based on selected support level -->
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mb-20">
                                <h3>Your Energy-Saving Plan</h3>
                                <div class="final-plan-container">
                                    <div id="final-plan-items">
                                        <!-- Plan items will be displayed here -->
                                    </div>
                                    
                                    <div class="plan-summary">
                                        <p>Total Savings: <span id="study2-total-savings">0</span> kWh</p>
                                        <p>Progress to Goal: <span id="study2-goal-progress">0</span>%</p>
                                        <div class="progress-bar">
                                            <div class="progress-fill" id="study2-progress-fill" style="width: 0%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <h3>Post-Task Questionnaires</h3>
                                <p>After completing the planning task, participants would answer questions about:</p>
                                <div class="questionnaire-tabs">
                                    <div class="questionnaire-tab active" data-questionnaire="cognitive-load">Cognitive Load</div>
                                    <div class="questionnaire-tab" data-questionnaire="agency">Sense of Agency</div>
                                </div>
                                
                                <div class="questionnaire-content">
                                    <div id="cognitive-load-questions" class="questionnaire-panel active">
                                        <!-- Will be populated with cognitive load questions -->
                                    </div>
                                    
                                    <div id="agency-questions" class="questionnaire-panel">
                                        <!-- Will be populated with agency questions -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Background Materials tab content -->
            <section id="background-materials" class="tab-content">
                <h2>Background: Materials &amp; Hypotheses</h2>
                
                <div class="card mb-20">
                    <h3>Research Overview</h3>
                    <p>This research investigates how Large Language Models (LLMs) can support individuals in creating accurate and effective energy reduction plans. The studies focus on the following aspects:</p>
                    <ul>
                        <li>How LLM-provided information influences energy planning accuracy</li>
                        <li>How different levels of LLM structural support affect plan quality and user experience</li>
                        <li>How access to accurate appliance-level energy information affects planning decisions</li>
                    </ul>
                </div>
                
                <div class="card mb-20">
                    <h3>Study 1: LLM as Information Source</h3>
                    <h4>Purpose</h4>
                    <p>Investigate how providing access to an LLM functioning solely as a reactive, on-demand information source influences the accuracy of household energy-saving plans.</p>
                    
                    <h4>Method</h4>
                    <p>Participants create energy reduction plans while using an LLM to query information about specific energy-saving actions. The LLM provides quantitative estimates for queried actions but offers no unsolicited advice or planning structure.</p>
                    
                    <h4>Hypotheses</h4>
                    <ol>
                        <li><strong>H1 (Accuracy):</strong> Participants with access to the LLM information source will formulate more accurate energy-saving plans compared to those relying solely on their own knowledge.</li>
                        <li><strong>H2 (Action Selection):</strong> Access to the LLM will lead participants to incorporate more high-impact actions related to heating, cooling, or water heating.</li>
                        <li><strong>H3 (Cognitive Load):</strong> Querying the LLM for specific savings estimates will reduce subjective cognitive load associated with the planning task.</li>
                        <li><strong>H4 (Trust and Reliance):</strong> Participants' trust in the LLM's information will correlate with the perceived accuracy of the LLM's responses.</li>
                    </ol>
                </div>
                
                <div class="card mb-20">
                    <h3>Study 2: Structured LLM Support</h3>
                    <h4>Purpose</h4>
                    <p>Explore how varying levels of structural support from an LLM during energy planning impact plan quality, cognitive load, and user agency.</p>
                    
                    <h4>Method</h4>
                    <p>Participants create energy reduction plans with one of four levels of LLM support:
                        </p><ol>
                            <li><strong>Control (No LLM):</strong> Participants plan independently without LLM assistance.</li>
                            <li><strong>LLM as Information Source:</strong> LLM provides information when queried but does not structure the planning process.</li>
                            <li><strong>LLM as Structured Prompter:</strong> LLM guides participants through a structured planning process with prompts and clarifying questions.</li>
                            <li><strong>LLM Drafts Plan:</strong> LLM generates a complete draft plan that participants can review and edit.</li>
                        </ol>
                    <p></p>
                    
                    <h4>Hypotheses</h4>
                    <ol>
                        <li><strong>H1 (Cognitive Load):</strong> Perceived cognitive load will decrease as the level of structural support from the LLM increases.</li>
                        <li><strong>H2 (Plan Accuracy):</strong> Plan accuracy will be highest in conditions where the LLM provides direct support related to calculation or structure.</li>
                        <li><strong>H3 (Plan Specificity):</strong> Plan specificity will be higher when users are guided to elaborate on actions or actively select/modify content.</li>
                        <li><strong>H4 (Sense of Agency/Ownership):</strong> Sense of agency will be highest in the Control and Information Source conditions and lowest in the LLM Drafts condition.</li>
                        <li><strong>H5 (Efficiency):</strong> Planning efficiency will improve as the level of structural support increases.</li>
                    </ol>
                </div>
                
                <div class="card">
                    <h3>Theoretical Background</h3>
                    <p>This research draws on several theoretical frameworks:</p>
                    
                    <h4>Bounded Rationality</h4>
                    <p>People make decisions with limited cognitive resources, information, and time. LLMs may compensate for these limitations by providing on-demand information and reducing cognitive load.</p>
                    
                    <h4>Cognitive Load Theory</h4>
                    <p>Complex tasks like energy planning impose high cognitive demands. External tools like LLMs can offload some of this demand, potentially improving task performance.</p>
                    
                    <h4>Human-AI Interaction &amp; Agency</h4>
                    <p>Different levels of AI assistance influence not only task performance but also user experience, including trust, reliance, and sense of agency or control over the process and outcome.</p>
                </div>
            </section>
            
            <!-- Household Profiles tab content -->
            <section id="background-profiles" class="tab-content">
                <h2>Background: Household Profiles</h2>
                
                <div class="card mb-20">
                    <h3>About the Profiles</h3>
                    <p>These household profiles represent varied baseline consumption levels and contexts, grounded in typical usage data from the U.S. Energy Information Administration's Residential Energy Consumption Survey (RECS).</p>
                    <p>The average U.S. household electricity consumption is approximately 10,600 kWh/year, but this varies significantly by region, home size, climate, and household composition.</p>
                </div>
                
                <div class="profiles-container" id="profiles-container">
                    <!-- Will be populated with household profiles -->
                </div>
            </section>
            
            <!-- Energy Actions tab content -->
            <section id="background-actions" class="tab-content">
                <h2>Background: Energy Actions</h2>
                
                <div class="card mb-20">
                    <h3>About the Energy Actions Database</h3>
                    <p>This database contains energy-saving actions with research-informed estimates of potential savings. The data is drawn from reputable sources including ENERGY STAR, the U.S. Department of Energy, and academic research.</p>
                    <p>Savings estimates are presented in annual kWh, though actual savings may vary based on climate, usage patterns, and baseline equipment.</p>
                </div>
                
                <div class="actions-controls mb-20">
                    <div class="search-filter">
                        <input type="text" id="actions-search" placeholder="Search actions...">
                    </div>
                    
                    <div class="category-filter">
                        <label for="actions-category">Filter by category:</label>
                        <select id="actions-category">
                            <option value="all">All Categories</option>
                            <option value="Lighting">Lighting</option>
                            <option value="Heating/Cooling">Heating/Cooling</option>
                            <option value="Water Heating">Water Heating</option>
                            <option value="Appliances/Electronics">Appliances/Electronics</option>
                        </select>
                    </div>
                    
                    <div class="sort-control">
                        <label for="actions-sort">Sort by:</label>
                        <select id="actions-sort">
                            <option value="savings">Highest Savings</option>
                            <option value="category">Category</option>
                            <option value="difficulty">Difficulty</option>
                            <option value="cost">Upfront Cost</option>
                        </select>
                    </div>
                </div>
                
                <div id="actions-table-container">
                    <table id="actions-table" class="actions-table">
                        <thead>
                            <tr>
                                <th>Action</th>
                                <th>Category</th>
                                <th>Annual Savings (kWh)</th>
                                <th>% of Profile 1</th>
                                <th>Difficulty</th>
                                <th>Upfront Cost</th>
                            </tr>
                        </thead>
                        <tbody id="actions-table-body">
                            <!-- Will be populated with energy actions -->
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>
    
    <script>
        // Data structures for the application
        
        // Household Profiles
        const householdProfiles = [
            {
                id: 1,
                name: "Small Apartment, Moderate Climate",
                description: "2-bedroom apartment, 2 occupants, moderate climate zone",
                annualUsage: 8500, // kWh per year
                monthlyCost: 110, // estimated monthly electric bill in dollars
                breakdown: {
                    heatingCooling: 25, // percentage
                    waterHeating: 15,
                    lighting: 10,
                    refrigeration: 8,
                    electronicsAppliances: 42
                }
            },
            {
                id: 2,
                name: "Large Home, Cold Climate",
                description: "4-bedroom single-family home, 4 occupants, cold climate zone, electric heat",
                annualUsage: 14000, // kWh per year
                monthlyCost: 180, // estimated monthly electric bill in dollars
                breakdown: {
                    heatingCooling: 45, // percentage
                    waterHeating: 20,
                    lighting: 8,
                    refrigeration: 6,
                    electronicsAppliances: 21
                }
            },
            {
                id: 3,
                name: "Medium Home, Hot Climate",
                description: "3-bedroom single-family home, 3 occupants, hot climate zone",
                annualUsage: 11500, // kWh per year
                monthlyCost: 150, // estimated monthly electric bill in dollars
                breakdown: {
                    heatingCooling: 50, // percentage (primarily cooling)
                    waterHeating: 12,
                    lighting: 9,
                    refrigeration: 7,
                    electronicsAppliances: 22
                }
            }
        ];

        // Energy Saving Actions
        const energyActions = [
            {
                id: "lighting-1",
                category: "Lighting",
                action: "Replace one 60W incandescent bulb with a 10W LED",
                assumptions: "Used 3 hrs/day",
                savingsKWh: 55, // annual kWh savings
                savingsPercent: {
                    1: 0.65, // For household profile ID 1, percentage savings
                    2: 0.39,
                    3: 0.48
                },
                savingsDollars: {
                    1: 7.15, // Annual dollar savings
                    2: 7.15,
                    3: 7.15
                },
                difficulty: "Easy",
                upfrontCost: "Low ($3-5 per bulb)"
            },
            {
                id: "lighting-2",
                category: "Lighting",
                action: "Replace five 60W incandescent bulbs with 10W LEDs",
                assumptions: "Used 3 hrs/day",
                savingsKWh: 275, // annual kWh savings
                savingsPercent: {
                    1: 3.24,
                    2: 1.96,
                    3: 2.39
                },
                savingsDollars: {
                    1: 35.75,
                    2: 35.75,
                    3: 35.75
                },
                difficulty: "Easy",
                upfrontCost: "Low ($15-25 total)"
            },
            {
                id: "lighting-3",
                category: "Lighting",
                action: "Install motion sensor for outdoor lighting",
                assumptions: "Avoiding 6 hrs/night unnecessary use of 100W bulb",
                savingsKWh: 220, // annual kWh savings
                savingsPercent: {
                    1: 2.59,
                    2: 1.57,
                    3: 1.91
                },
                savingsDollars: {
                    1: 28.60,
                    2: 28.60,
                    3: 28.60
                },
                difficulty: "Medium",
                upfrontCost: "Medium ($20-40)"
            },
            {
                id: "heating-1",
                category: "Heating/Cooling",
                action: "Lower thermostat by 1°F for 8 hours/day during heating season",
                assumptions: "Average home in moderate climate",
                savingsKWh: 175, // Approximate value, varies by climate
                savingsPercent: {
                    1: 2.06,
                    2: 1.25,
                    3: 1.52
                },
                savingsDollars: {
                    1: 22.75,
                    2: 22.75,
                    3: 22.75
                },
                difficulty: "Easy",
                upfrontCost: "None"
            },
            {
                id: "heating-2",
                category: "Heating/Cooling",
                action: "Lower thermostat by 2°F for 24 hours/day during heating season",
                assumptions: "Average home in moderate climate",
                savingsKWh: 650, // Approximate value, varies by climate
                savingsPercent: {
                    1: 7.65,
                    2: 4.64,
                    3: 5.65
                },
                savingsDollars: {
                    1: 84.50,
                    2: 84.50,
                    3: 84.50
                },
                difficulty: "Medium",
                upfrontCost: "None"
            },
            {
                id: "thermostat-1",
                category: "Heating/Cooling",
                action: "Install programmable/smart thermostat",
                assumptions: "Proper programming for temperature setbacks",
                savingsKWh: 750, // Varies significantly by usage patterns
                savingsPercent: {
                    1: 8.82,
                    2: 5.36,
                    3: 6.52
                },
                savingsDollars: {
                    1: 97.50,
                    2: 97.50,
                    3: 97.50
                },
                difficulty: "Medium",
                upfrontCost: "Medium to High ($80-250)"
            },
            {
                id: "waterheater-1",
                category: "Water Heating",
                action: "Lower water heater thermostat from 140°F to 120°F",
                assumptions: "Electric water heater",
                savingsKWh: 300, // Varies by household size/usage
                savingsPercent: {
                    1: 3.53,
                    2: 2.14,
                    3: 2.61
                },
                savingsDollars: {
                    1: 39.00,
                    2: 39.00,
                    3: 39.00
                },
                difficulty: "Easy",
                upfrontCost: "None"
            },
            {
                id: "waterheater-2",
                category: "Water Heating",
                action: "Install low-flow showerhead",
                assumptions: "Family of 4, electric water heater",
                savingsKWh: 400, // Varies by household size/usage
                savingsPercent: {
                    1: 4.71,
                    2: 2.86,
                    3: 3.48
                },
                savingsDollars: {
                    1: 52.00,
                    2: 52.00,
                    3: 52.00
                },
                difficulty: "Easy",
                upfrontCost: "Low ($10-30)"
            },
            {
                id: "laundry-1",
                category: "Water Heating",
                action: "Wash clothes in cold water instead of hot",
                assumptions: "8 loads per week, electric water heater",
                savingsKWh: 400, // Varies by usage frequency
                savingsPercent: {
                    1: 4.71,
                    2: 2.86,
                    3: 3.48
                },
                savingsDollars: {
                    1: 52.00,
                    2: 52.00,
                    3: 52.00
                },
                difficulty: "Easy",
                upfrontCost: "None"
            },
            {
                id: "vampirepower-1",
                category: "Appliances/Electronics",
                action: "Unplug 'vampire' electronics when not in use",
                assumptions: "Entertainment center, chargers, etc. (saving ~5W continuous)",
                savingsKWh: 44, // Varies by number of devices
                savingsPercent: {
                    1: 0.52,
                    2: 0.31,
                    3: 0.38
                },
                savingsDollars: {
                    1: 5.72,
                    2: 5.72,
                    3: 5.72
                },
                difficulty: "Easy",
                upfrontCost: "None"
            },
            {
                id: "dryer-1",
                category: "Appliances/Electronics",
                action: "Air dry clothes instead of using electric dryer",
                assumptions: "2 loads/week",
                savingsKWh: 300, // Varies by dryer efficiency and usage
                savingsPercent: {
                    1: 3.53,
                    2: 2.14,
                    3: 2.61
                },
                savingsDollars: {
                    1: 39.00,
                    2: 39.00,
                    3: 39.00
                },
                difficulty: "Medium",
                upfrontCost: "Low ($10-30 for drying rack/clothesline)"
            },
            {
                id: "refrigerator-1",
                category: "Appliances/Electronics",
                action: "Replace old refrigerator with ENERGY STAR model",
                assumptions: "15+ year old refrigerator",
                savingsKWh: 200, // Varies by age and efficiency of old unit
                savingsPercent: {
                    1: 2.35,
                    2: 1.43,
                    3: 1.74
                },
                savingsDollars: {
                    1: 26.00,
                    2: 26.00,
                    3: 26.00
                },
                difficulty: "Hard",
                upfrontCost: "High ($700-2000)"
            }
        ];

        // Survey questions based on Attari et al. 2010 and other studies
        const surveyQuestions = {
            energyLiteracy: [
                {
                    id: "el1",
                    question: "Which of the following typically uses the MOST energy in an average U.S. home?",
                    options: ["Lighting", "Refrigerator", "Water Heating", "Television"],
                    correctAnswer: "Water Heating"
                },
                {
                    id: "el2",
                    question: "How many times more energy does a clothes dryer use compared to a ceiling fan (per hour of operation)?",
                    options: ["About 2 times more", "About 10 times more", "About 40 times more", "About 100 times more"],
                    correctAnswer: "About 40 times more"
                },
                {
                    id: "el3",
                    question: "Which action saves more energy?",
                    options: [
                        "Turning off a light bulb for 1 hour that's been on", 
                        "Turning off 10 light bulbs for 6 minutes that have been on",
                        "Both save the same amount of energy"
                    ],
                    correctAnswer: "Both save the same amount of energy"
                }
            ],
            cognitiveLoad: [
                {
                    id: "cl1",
                    question: "Mental Demand: How mentally demanding was the task?",
                    type: "slider",
                    min: 1,
                    max: 7,
                    labels: ["Very Low", "Very High"]
                },
                {
                    id: "cl2",
                    question: "Temporal Demand: How hurried or rushed was the pace of the task?",
                    type: "slider",
                    min: 1,
                    max: 7,
                    labels: ["Very Low", "Very High"]
                },
                {
                    id: "cl3",
                    question: "Effort: How hard did you have to work to accomplish your level of performance?",
                    type: "slider",
                    min: 1,
                    max: 7,
                    labels: ["Very Low", "Very High"]
                },
                {
                    id: "cl4",
                    question: "Frustration: How irritated, stressed, and annoyed were you?",
                    type: "slider",
                    min: 1,
                    max: 7,
                    labels: ["Very Low", "Very High"]
                }
            ],
            agency: [
                {
                    id: "ag1",
                    question: "I felt in control of the planning process",
                    type: "likert",
                    scale: 5
                },
                {
                    id: "ag2",
                    question: "I feel ownership over the final plan",
                    type: "likert",
                    scale: 5
                },
                {
                    id: "ag3",
                    question: "The plan reflects my personal priorities and preferences",
                    type: "likert",
                    scale: 5
                },
                {
                    id: "ag4",
                    question: "I would feel confident implementing this plan in my own home",
                    type: "likert",
                    scale: 5
                }
            ]
        };

        // Pre-generated LLM response templates
        const llmResponseTemplates = {
            // For Study 1 - Information Source condition
            informationSource: {
                // Responses about energy actions in different formats
                getActionResponse: function(actionId, format = 'kwh') {
                    const action = energyActions.find(a => a.id === actionId);
                    if (!action) {
                        return this.notUnderstood;
                    }
                    
                    // Household profile ID for this demo
                    const profileId = 1; // Using the first profile by default
                    
                    if (format === 'kwh') {
                        return `${action.action} is estimated to save approximately ${action.savingsKWh} kWh per year, assuming ${action.assumptions}.`;
                    } 
                    else if (format === 'percent') {
                        return `${action.action} is estimated to save approximately ${action.savingsPercent[profileId]}% of your total household electricity use per year, assuming ${action.assumptions}.`;
                    }
                    else if (format === 'dollars') {
                        return `${action.action} is estimated to save approximately $${action.savingsDollars[profileId]} per year on your electricity bill, assuming ${action.assumptions}.`;
                    }
                    
                    return this.notUnderstood;
                },
                
                // Handle general information queries
                generalInfo: {
                    "kwh": "A kilowatt-hour (kWh) is a unit of energy equal to 1,000 watt-hours. It represents the energy consumed by a 1,000-watt appliance running for one hour. This is the standard unit used on electricity bills.",
                    "thermostat": "Adjusting your thermostat settings is one of the most impactful ways to save energy. Each degree of adjustment for heating or cooling can save approximately 1-3% on your related energy costs.",
                    "vampire power": "Vampire power (or standby power) refers to the electricity consumed by devices when they're turned off but still plugged in. This can account for 5-10% of residential electricity use.",
                    "led": "LED bulbs use up to 90% less energy than traditional incandescent bulbs and can last 15-25 times longer. Replacing frequently used bulbs with LEDs is one of the easiest ways to save energy.",
                    "water heating": "Water heating accounts for about 18% of home energy use nationally, making it one of the largest energy expenses in most households."
                },
                
                // Default response if query isn't understood
                notUnderstood: "I'm sorry, I don't have specific information on that. Could you ask about a specific energy-saving action, or try rephrasing your question?"
            },
            
            // For Study 2 - Structured Support conditions
            structuredPrompter: {
                // Initial prompt to start the planning process
                intro: "Let's create an energy-saving plan to reach your goal. I'll guide you through different categories of energy use in your home.",
                
                // Prompts for different energy categories
                categoryPrompts: {
                    heatingCooling: (percent) => `Let's start with heating and cooling, which makes up ${percent}% of your household energy use. What specific actions would you like to include in your plan?`,
                    waterHeating: (percent) => `Now let's consider water heating, which accounts for ${percent}% of your energy use. What actions could you take in this category?`,
                    lighting: (percent) => `Let's look at lighting, which makes up ${percent}% of your energy use. What lighting changes would you like to include?`,
                    appliances: (percent) => `Finally, let's address appliances and electronics, which account for ${percent}% of your usage. What actions could you take here?`
                },
                
                // Prompts to ask for clarification or details
                clarificationPrompts: {
                    specificity: "Could you be more specific about how you would implement that action?",
                    frequency: "How often would you perform this action?",
                    feasibility: "How feasible would this action be for your household to implement?"
                },
                
                // Summary prompt to recap the plan
                summary: (actions, savings, goal) => `So far, your plan includes: ${actions}. These actions would save approximately ${savings} kWh per year. Your goal is ${goal} kWh. Would you like to add more actions or finalize this plan?`
            },
            
            // For Study 2 - Draft Plan condition
            draftPlanner: {
                // Generate a complete draft plan based on profile and target
                generatePlan: function(profileId, targetSavings) {
                    // Filter actions that are feasible and sort by savings
                    const profile = householdProfiles.find(p => p.id === parseInt(profileId));
                    const relevantActions = energyActions
                        .filter(a => a.difficulty !== "Hard") // Filter out difficult actions for a reasonable default plan
                        .sort((a, b) => b.savingsKWh - a.savingsKWh); // Sort by highest savings first
                    
                    // Select actions to meet the target
                    let selectedActions = [];
                    let totalSavings = 0;
                    
                    for (const action of relevantActions) {
                        if (totalSavings < targetSavings) {
                            selectedActions.push(action);
                            totalSavings += action.savingsKWh;
                        }
                        
                        // If we've exceeded the target by a significant amount, try to optimize
                        if (totalSavings > targetSavings * 1.5) {
                            // Remove the last action and look for something smaller
                            const lastAction = selectedActions.pop();
                            totalSavings -= lastAction.savingsKWh;
                            
                            // Find a better fit if possible
                            const betterFit = relevantActions.find(a => 
                                !selectedActions.includes(a) && 
                                a.savingsKWh + totalSavings >= targetSavings && 
                                a.savingsKWh + totalSavings < lastAction.savingsKWh + totalSavings
                            );
                            
                            if (betterFit) {
                                selectedActions.push(betterFit);
                                totalSavings += betterFit.savingsKWh;
                            } else {
                                // If no better fit, put the last action back
                                selectedActions.push(lastAction);
                                totalSavings += lastAction.savingsKWh;
                            }
                        }
                        
                        // If we're reasonably close to the target, stop
                        if (totalSavings >= targetSavings * 0.9 && totalSavings <= targetSavings * 1.2) {
                            break;
                        }
                    }
                    
                    // Format the plan as a response
                    let planText = `Based on your household profile, here's a draft energy-saving plan to achieve your target of saving ${targetSavings} kWh per year:\n\n`;
                    
                    selectedActions.forEach((action, index) => {
                        planText += `${index + 1}. ${action.action} - Saves approximately ${action.savingsKWh} kWh/year\n`;
                    });
                    
                    planText += `\nTotal estimated savings: ${totalSavings.toFixed(0)} kWh/year (${(totalSavings / profile.annualUsage * 100).toFixed(1)}% of your current usage)`;
                    planText += `\n\nPlease review this draft plan. You can add, remove, or modify actions to better suit your preferences.`;
                    
                    return planText;
                }
            }
        };

        // Tab navigation functionality
        document.addEventListener('DOMContentLoaded', function() {
            const tabItems = document.querySelectorAll('.tab-item');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabItems.forEach(item => {
                item.addEventListener('click', function() {
                    // Remove active class from all tabs
                    tabItems.forEach(tab => tab.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    // Add active class to clicked tab
                    this.classList.add('active');
                    
                    // Show corresponding content
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // Initialize Study 1 functionality
            initializeStudy1();
            
            // Initialize Study 2 functionality
            initializeStudy2();
            
            // Initialize Background tabs
            initializeBackgroundTabs();
        });

        // Initialize Study 1 functionality
        function initializeStudy1() {
            // Initialize the chat functionality
            const chatMessages = document.getElementById('chat-messages');
            const chatInput = document.getElementById('chat-input');
            const sendButton = document.getElementById('send-message');
            
            // Function to add a message to the chat
            function addMessage(message, isUser = false) {
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('message');
                messageDiv.classList.add(isUser ? 'user-message' : 'ai-message');
                messageDiv.textContent = message;
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // Handle send button click
            sendButton.addEventListener('click', function() {
                const message = chatInput.value.trim();
                if (message) {
                    addMessage(message, true);
                    chatInput.value = '';
                    
                    // Process the message and generate a response
                    setTimeout(() => {
                        const response = processUserMessage(message);
                        addMessage(response);
                    }, 500);
                }
            });
            
            // Handle Enter key press in chat input
            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendButton.click();
                }
            });
            
            // Handle suggestion buttons
            const suggestionButtons = document.querySelectorAll('.suggestion-btn');
            suggestionButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const query = this.getAttribute('data-query');
                    chatInput.value = query;
                    sendButton.click();
                });
            });
            
            // Process user messages and generate responses
            function processUserMessage(message) {
                // Convert message to lowercase for easier matching
                const lowerMessage = message.toLowerCase();
                
                // Check for action-specific queries
                for (const action of energyActions) {
                    const actionKeywords = action.action.toLowerCase().split(' ');
                    
                    // Check if the message contains key terms from the action
                    const containsActionKeywords = actionKeywords.some(keyword => 
                        keyword.length > 3 && lowerMessage.includes(keyword)
                    );
                    
                    if (containsActionKeywords) {
                        // Determine which format to use
                        let format = 'kwh'; // Default format
                        
                        if (lowerMessage.includes('percent') || lowerMessage.includes('%')) {
                            format = 'percent';
                        } else if (lowerMessage.includes('dollar') || lowerMessage.includes('$') || lowerMessage.includes('cost')) {
                            format = 'dollars';
                        }
                        
                        return llmResponseTemplates.informationSource.getActionResponse(action.id, format);
                    }
                }
                
                // Check for general information queries
                for (const [keyword, response] of Object.entries(llmResponseTemplates.informationSource.generalInfo)) {
                    if (lowerMessage.includes(keyword.toLowerCase())) {
                        return response;
                    }
                }
                
                // Default response
                return llmResponseTemplates.informationSource.notUnderstood;
            }
            
            // Initialize the plan functionality
            const planItems = document.getElementById('plan-items');
            const planActionInput = document.getElementById('plan-action-input');
            const planSavingsInput = document.getElementById('plan-savings-input');
            const addToPlanButton = document.getElementById('add-to-plan');
            const totalSavingsElement = document.getElementById('total-savings');
            const goalProgressElement = document.getElementById('goal-progress');
            const progressFill = document.querySelector('.progress-fill');
            
            let totalSavings = 0;
            const goal = 850; // 10% of the profile's annual usage
            
            // Handle add to plan button
            addToPlanButton.addEventListener('click', function() {
                const action = planActionInput.value.trim();
                const savings = parseInt(planSavingsInput.value);
                
                if (action && !isNaN(savings) && savings > 0) {
                    addToPlan(action, savings);
                    planActionInput.value = '';
                    planSavingsInput.value = '';
                }
            });
            
            // Function to add an action to the plan
            function addToPlan(action, savings) {
                const planItem = document.createElement('div');
                planItem.classList.add('plan-item');
                planItem.innerHTML = `
                    <span>${action}</span>
                    <span>${savings} kWh</span>
                    <button class="remove-action">X</button>
                `;
                
                // Add remove button functionality
                const removeButton = planItem.querySelector('.remove-action');
                removeButton.addEventListener('click', function() {
                    totalSavings -= savings;
                    updatePlanSummary();
                    planItem.remove();
                });
                
                planItems.appendChild(planItem);
                
                // Update total savings
                totalSavings += savings;
                updatePlanSummary();
            }
            
            // Update the plan summary
            function updatePlanSummary() {
                totalSavingsElement.textContent = totalSavings;
                
                const progress = Math.min(100, (totalSavings / goal) * 100);
                goalProgressElement.textContent = progress.toFixed(1);
                progressFill.style.width = `${progress}%`;
                
                // Change color based on progress
                if (progress < 50) {
                    progressFill.style.backgroundColor = '#f7941d';
                } else if (progress < 90) {
                    progressFill.style.backgroundColor = '#ffc107';
                } else if (progress <= 110) {
                    progressFill.style.backgroundColor = '#28a745';
                } else {
                    progressFill.style.backgroundColor = '#dc3545'; // Over the goal
                }
            }
            
            // Handle goal format selection
            const goalFormatRadios = document.querySelectorAll('input[name="goal-format"]');
            goalFormatRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    const format = this.value;
                    
                    if (format === 'kwh') {
                        planSavingsInput.placeholder = 'kWh saved';
                    } else if (format === 'percent') {
                        planSavingsInput.placeholder = '% saved';
                    } else if (format === 'dollars') {
                        planSavingsInput.placeholder = '$ saved';
                    }
                });
            });
            
            // Handle the check answers button
            const checkAnswersButton = document.getElementById('check-answers');
            const surveyResultsDiv = document.getElementById('survey-results');
            
            checkAnswersButton.addEventListener('click', function() {
                let correctCount = 0;
                let totalQuestions = 0;
                
                surveyQuestions.energyLiteracy.slice(0, 3).forEach((question, index) => {
                    const selectedOption = document.querySelector(`input[name="q${index}"]:checked`);
                    totalQuestions++;
                    
                    if (selectedOption && selectedOption.value === question.correctAnswer) {
                        correctCount++;
                    }
                });
                
                // Display the results
                surveyResultsDiv.innerHTML = `You got ${correctCount} out of ${totalQuestions} questions correct!`;
                
                if (correctCount === totalQuestions) {
                    surveyResultsDiv.classList.add('result-correct');
                    surveyResultsDiv.classList.remove('result-incorrect');
                } else {
                    surveyResultsDiv.classList.add('result-incorrect');
                    surveyResultsDiv.classList.remove('result-correct');
                }
                
                surveyResultsDiv.style.display = 'block';
            });
        }

        // Initialize Study 2 functionality
        function initializeStudy2() {
            // Populate cognitive load questions
            const cognitiveLoadQuestions = document.getElementById('cognitive-load-questions');
            surveyQuestions.cognitiveLoad.forEach((question, index) => {
                const questionHTML = `
                    <div class="question-item">
                        <p><strong>${question.question}</strong></p>
                        <div class="slider-container">
                            <span>${question.labels[0]}</span>
                            <input type="range" min="${question.min}" max="${question.max}" value="${Math.ceil((question.max - question.min) / 2) + question.min}" id="cl-q${index}">
                            <span>${question.labels[1]}</span>
                        </div>
                    </div>
                `;
                cognitiveLoadQuestions.innerHTML += questionHTML;
            });
            
            // Populate agency questions
            const agencyQuestions = document.getElementById('agency-questions');
            surveyQuestions.agency.forEach((question, index) => {
                const questionHTML = `
                    <div class="question-item">
                        <p><strong>${question.question}</strong></p>
                        <div class="likert-options">
                            ${Array.from({length: question.scale}, (_, i) => {
                                const label = i === 0 ? 'Strongly Disagree' : 
                                          i === question.scale - 1 ? 'Strongly Agree' : '';
                                return `
                                    <div class="likert-option">
                                        <input type="radio" name="ag-q${index}" value="${i + 1}" id="ag-q${index}-${i + 1}">
                                        <label for="ag-q${index}-${i + 1}">${label}</label>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
                agencyQuestions.innerHTML += questionHTML;
            });
            
            // Set up questionnaire tab switching
            const questionnaireTabs = document.querySelectorAll('.questionnaire-tab');
            const questionnairePanels = document.querySelectorAll('.questionnaire-panel');
            
            questionnaireTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const questionnaire = this.getAttribute('data-questionnaire');
                    
                    // Deactivate all tabs and panels
                    questionnaireTabs.forEach(t => t.classList.remove('active'));
                    questionnairePanels.forEach(p => p.classList.remove('active'));
                    
                    // Activate selected tab and panel
                    this.classList.add('active');
                    document.getElementById(`${questionnaire}-questions`).classList.add('active');
                });
            });
            
            // Function to update the household profile display
            function updateProfileDisplay(profileId) {
                const profile = householdProfiles.find(p => p.id === parseInt(profileId));
                const profileDisplay = document.getElementById('study2-profile-display');
                
                profileDisplay.innerHTML = `
                    <h4>${profile.name}</h4>
                    <p>${profile.description}</p>
                    <p><strong>Annual Electricity Use:</strong> ${profile.annualUsage} kWh</p>
                    <p><strong>Monthly Cost:</strong> $${profile.monthlyCost}</p>
                    
                    <h4>Energy Breakdown:</h4>
                    <div class="energy-breakdown">
                        <div class="breakdown-item">
                            <span>Heating/Cooling:</span>
                            <span>${profile.breakdown.heatingCooling}%</span>
                        </div>
                        <div class="breakdown-item">
                            <span>Water Heating:</span>
                            <span>${profile.breakdown.waterHeating}%</span>
                        </div>
                        <div class="breakdown-item">
                            <span>Lighting:</span>
                            <span>${profile.breakdown.lighting}%</span>
                        </div>
                        <div class="breakdown-item">
                            <span>Refrigeration:</span>
                            <span>${profile.breakdown.refrigeration}%</span>
                        </div>
                        <div class="breakdown-item">
                            <span>Electronics/Appliances:</span>
                            <span>${profile.breakdown.electronicsAppliances}%</span>
                        </div>
                    </div>
                `;
                
                // Update reduction goal (10% of profile's annual usage)
                const reductionGoal = Math.round(profile.annualUsage * 0.1);
                document.getElementById('reduction-goal').textContent = reductionGoal;
                
                return profile;
            }
            
            // Function to update available actions
            function updateAvailableActions(profileId, categoryFilter = 'all') {
                const actionsContainer = document.getElementById('available-actions');
                actionsContainer.innerHTML = '';
                
                let filteredActions = energyActions;
                
                // Apply category filter if not 'all'
                if (categoryFilter !== 'all') {
                    filteredActions = energyActions.filter(action => action.category === categoryFilter);
                }
                
                // Sort by category and then by savings
                filteredActions.sort((a, b) => {
                    if (a.category !== b.category) {
                        return a.category.localeCompare(b.category);
                    }
                    return b.savingsKWh - a.savingsKWh;
                });
                
                filteredActions.forEach(action => {
                    const actionElement = document.createElement('div');
                    actionElement.classList.add('action-item');
                    actionElement.setAttribute('data-action-id', action.id);
                    
                    actionElement.innerHTML = `
                        <h4>${action.action}</h4>
                        <div class="action-details">
                            <p><strong>Category:</strong> ${action.category}</p>
                            <p><strong>Assumptions:</strong> ${action.assumptions}</p>
                            <p class="action-savings">Saves approximately ${action.savingsKWh} kWh per year</p>
                            <p><strong>Difficulty:</strong> ${action.difficulty}</p>
                            <p><strong>Upfront Cost:</strong> ${action.upfrontCost}</p>
                        </div>
                    `;
                    
                    // Add click handler to add to plan
                    actionElement.addEventListener('click', function() {
                        addToFinalPlan(action);
                    });
                    
                    actionsContainer.appendChild(actionElement);
                });
            }
            
            // Function to add an action to the final plan
            function addToFinalPlan(action) {
                const finalPlanItems = document.getElementById('final-plan-items');
                
                // Check if the action is already in the plan
                const existingItem = document.querySelector(`.final-plan-item[data-action-id="${action.id}"]`);
                if (existingItem) {
                    return; // Action already in plan
                }
                
                const planItem = document.createElement('div');
                planItem.classList.add('final-plan-item');
                planItem.setAttribute('data-action-id', action.id);
                planItem.setAttribute('data-savings', action.savingsKWh);
                
                planItem.innerHTML = `
                    <span>${action.action}</span>
                    <span>${action.savingsKWh} kWh</span>
                    <button class="remove-action">X</button>
                `;
                
                // Add remove button functionality
                const removeButton = planItem.querySelector('.remove-action');
                removeButton.addEventListener('click', function(e) {
                    e.stopPropagation();
                    planItem.remove();
                    updatePlanSummary();
                });
                
                finalPlanItems.appendChild(planItem);
                updatePlanSummary();
            }
            
            // Function to update the plan summary
            function updatePlanSummary() {
                const planItems = document.querySelectorAll('.final-plan-item');
                const totalSavingsElement = document.getElementById('study2-total-savings');
                const goalProgressElement = document.getElementById('study2-goal-progress');
                const progressFill = document.getElementById('study2-progress-fill');
                
                // Calculate total savings
                let totalSavings = 0;
                planItems.forEach(item => {
                    totalSavings += parseInt(item.getAttribute('data-savings'));
                });
                
                totalSavingsElement.textContent = totalSavings;
                
                // Calculate progress based on the current goal
                const goal = parseInt(document.getElementById('reduction-goal').textContent);
                const progress = Math.min(100, (totalSavings / goal) * 100);
                goalProgressElement.textContent = progress.toFixed(1);
                progressFill.style.width = `${progress}%`;
                
                // Change color based on progress
                if (progress < 50) {
                    progressFill.style.backgroundColor = '#f7941d';
                } else if (progress < 90) {
                    progressFill.style.backgroundColor = '#ffc107';
                } else if (progress <= 110) {
                    progressFill.style.backgroundColor = '#28a745';
                } else {
                    progressFill.style.backgroundColor = '#dc3545'; // Over the goal
                }
            }
            
            // Function to update the planning interface based on the selected support level
            function updatePlanningInterface(supportLevel, profileId) {
                const planningInterface = document.getElementById('planning-interface');
                const profile = householdProfiles.find(p => p.id === parseInt(profileId));
                const goal = Math.round(profile.annualUsage * 0.1);
                
                switch (supportLevel) {
                    case 'control':
                        planningInterface.innerHTML = `
                            <div class="control-interface">
                                <p>Write your energy-saving plan to achieve the goal of ${goal} kWh reduction:</p>
                                <textarea id="control-plan-text" placeholder="List the actions you would take to save energy..."></textarea>
                                <button id="control-submit-plan" class="submit-plan-btn">Submit Plan</button>
                            </div>
                        `;
                        
                        // Add submit button handler
                        document.getElementById('control-submit-plan').addEventListener('click', function() {
                            const planText = document.getElementById('control-plan-text').value.trim();
                            if (planText) {
                                alert('Plan submitted! In a real study, this would be saved for analysis.');
                            } else {
                                alert('Please enter a plan before submitting.');
                            }
                        });
                        break;
                        
                    case 'information':
                        planningInterface.innerHTML = `
                            <div class="chat-interface">
                                <div class="structured-messages" id="info-messages">
                                    <div class="message ai-message">
                                        Hello! I can provide information about specific energy-saving actions to help you create your plan. What would you like to know?
                                    </div>
                                </div>
                                
                                <div class="chat-input">
                                    <input type="text" id="info-chat-input" placeholder="Ask about an energy-saving action...">
                                    <button id="info-send-message">Ask</button>
                                </div>
                            </div>
                        `;
                        
                        // Set up chat functionality
                        const infoMessages = document.getElementById('info-messages');
                        const infoChatInput = document.getElementById('info-chat-input');
                        const infoSendButton = document.getElementById('info-send-message');
                        
                        infoSendButton.addEventListener('click', function() {
                            const message = infoChatInput.value.trim();
                            if (message) {
                                // Add user message
                                const userMessageDiv = document.createElement('div');
                                userMessageDiv.classList.add('message', 'user-message');
                                userMessageDiv.textContent = message;
                                infoMessages.appendChild(userMessageDiv);
                                
                                infoChatInput.value = '';
                                infoMessages.scrollTop = infoMessages.scrollHeight;
                                
                                // Generate AI response
                                setTimeout(() => {
                                    const aiMessageDiv = document.createElement('div');
                                    aiMessageDiv.classList.add('message', 'ai-message');
                                    
                                    // Process the message to generate a response
                                    const response = processInfoMessage(message);
                                    aiMessageDiv.textContent = response;
                                    
                                    infoMessages.appendChild(aiMessageDiv);
                                    infoMessages.scrollTop = infoMessages.scrollHeight;
                                }, 500);
                            }
                        });
                        
                        infoChatInput.addEventListener('keypress', function(e) {
                            if (e.key === 'Enter') {
                                infoSendButton.click();
                            }
                        });
                        
                        function processInfoMessage(message) {
                            // Similar to Study 1 processing
                            const lowerMessage = message.toLowerCase();
                            
                            // Check for action-specific queries
                            for (const action of energyActions) {
                                const actionKeywords = action.action.toLowerCase().split(' ');
                                
                                const containsActionKeywords = actionKeywords.some(keyword => 
                                    keyword.length > 3 && lowerMessage.includes(keyword)
                                );
                                
                                if (containsActionKeywords) {
                                    return llmResponseTemplates.informationSource.getActionResponse(action.id, 'kwh');
                                }
                            }
                            
                            // Check for general information queries
                            for (const [keyword, response] of Object.entries(llmResponseTemplates.informationSource.generalInfo)) {
                                if (lowerMessage.includes(keyword.toLowerCase())) {
                                    return response;
                                }
                            }
                            
                            return llmResponseTemplates.informationSource.notUnderstood;
                        }
                        break;
                        
                    case 'structured':
                        planningInterface.innerHTML = `
                            <div class="chat-interface">
                                <div class="structured-messages" id="structured-messages">
                                    <div class="message ai-message">
                                        ${llmResponseTemplates.structuredPrompter.intro}
                                    </div>
                                    <div class="message ai-message">
                                        ${llmResponseTemplates.structuredPrompter.categoryPrompts.heatingCooling(profile.breakdown.heatingCooling)}
                                    </div>
                                </div>
                                
                                <div class="chat-input">
                                    <input type="text" id="structured-chat-input" placeholder="Respond to the assistant...">
                                    <button id="structured-send-message">Send</button>
                                </div>
                            </div>
                        `;
                        
                        // Set up chat functionality
                        const structuredMessages = document.getElementById('structured-messages');
                        const structuredChatInput = document.getElementById('structured-chat-input');
                        const structuredSendButton = document.getElementById('structured-send-message');
                        
                        let conversationStage = 'heating'; // Start with heating/cooling
                        
                        structuredSendButton.addEventListener('click', function() {
                            const message = structuredChatInput.value.trim();
                            if (message) {
                                // Add user message
                                const userMessageDiv = document.createElement('div');
                                userMessageDiv.classList.add('message', 'user-message');
                                userMessageDiv.textContent = message;
                                structuredMessages.appendChild(userMessageDiv);
                                
                                structuredChatInput.value = '';
                                structuredMessages.scrollTop = structuredMessages.scrollHeight;
                                
                                // Process user response and advance conversation
                                setTimeout(() => {
                                    const aiMessageDiv = document.createElement('div');
                                    aiMessageDiv.classList.add('message', 'ai-message');
                                    
                                    let response = '';
                                    
                                    // Simple state machine for the structured conversation
                                    switch (conversationStage) {
                                        case 'heating':
                                            response = llmResponseTemplates.structuredPrompter.categoryPrompts.waterHeating(profile.breakdown.waterHeating);
                                            conversationStage = 'water';
                                            break;
                                        case 'water':
                                            response = llmResponseTemplates.structuredPrompter.categoryPrompts.lighting(profile.breakdown.lighting);
                                            conversationStage = 'lighting';
                                            break;
                                        case 'lighting':
                                            response = llmResponseTemplates.structuredPrompter.categoryPrompts.appliances(profile.breakdown.electronicsAppliances);
                                            conversationStage = 'appliances';
                                            break;
                                        case 'appliances':
                                            // For demo purposes, we'll always ask for specificity
                                            response = llmResponseTemplates.structuredPrompter.clarificationPrompts.specificity;
                                            conversationStage = 'specificity';
                                            break;
                                        case 'specificity':
                                            // Get the current plan items to summarize
                                            const planItems = Array.from(document.querySelectorAll('.final-plan-item'))
                                                .map(item => item.querySelector('span').textContent);
                                            
                                            let totalSavings = 0;
                                            document.querySelectorAll('.final-plan-item').forEach(item => {
                                                totalSavings += parseInt(item.getAttribute('data-savings'));
                                            });
                                            
                                            response = llmResponseTemplates.structuredPrompter.summary(
                                                planItems.join(', '), 
                                                totalSavings, 
                                                goal
                                            );
                                            conversationStage = 'summary';
                                            break;
                                        case 'summary':
                                            response = "Great! You've completed your energy-saving plan. You can review and edit it in the section below.";
                                            conversationStage = 'done';
                                            break;
                                        default:
                                            response = "Thank you for creating your energy-saving plan.";
                                    }
                                    
                                    aiMessageDiv.textContent = response;
                                    structuredMessages.appendChild(aiMessageDiv);
                                    structuredMessages.scrollTop = structuredMessages.scrollHeight;
                                }, 500);
                            }
                        });
                        
                        structuredChatInput.addEventListener('keypress', function(e) {
                            if (e.key === 'Enter') {
                                structuredSendButton.click();
                            }
                        });
                        break;
                        
                    case 'draft':
                        const draftPlan = llmResponseTemplates.draftPlanner.generatePlan(parseInt(profileId), goal);
                        
                        planningInterface.innerHTML = `
                            <div class="draft-interface">
                                <p>I've created a draft energy-saving plan for you. Please review and edit it as needed:</p>
                                <div class="draft-plan">${draftPlan}</div>
                                
                                <p>You can edit the plan here:</p>
                                <textarea id="draft-edit-textarea">${draftPlan}</textarea>
                                <button id="draft-apply-edits" class="submit-plan-btn">Apply Edits</button>
                            </div>
                        `;
                        
                        // Parse the draft plan and add actions to the final plan
                        const draftPlanText = draftPlan;
                        const actionRegex = /\d+\.\s+(.*?)\s+-\s+Saves approximately\s+(\d+)\s+kWh/g;
                        let match;
                        
                        // Clear existing plan items
                        document.getElementById('final-plan-items').innerHTML = '';
                        
                        while ((match = actionRegex.exec(draftPlanText)) !== null) {
                            const actionText = match[1];
                            const savingsValue = parseInt(match[2]);
                            
                            // Find matching action from our database
                            const matchingAction = energyActions.find(action => 
                                action.action.toLowerCase() === actionText.toLowerCase() || 
                                action.action.toLowerCase().includes(actionText.toLowerCase())
                            );
                            
                            if (matchingAction) {
                                addToFinalPlan(matchingAction);
                            } else {
                                // If no exact match, create a custom plan item
                                const finalPlanItems = document.getElementById('final-plan-items');
                                const planItem = document.createElement('div');
                                planItem.classList.add('final-plan-item');
                                planItem.setAttribute('data-action-id', 'custom');
                                planItem.setAttribute('data-savings', savingsValue);
                                
                                planItem.innerHTML = `
                                    <span>${actionText}</span>
                                    <span>${savingsValue} kWh</span>
                                    <button class="remove-action">X</button>
                                `;
                                
                                const removeButton = planItem.querySelector('.remove-action');
                                removeButton.addEventListener('click', function(e) {
                                    e.stopPropagation();
                                    planItem.remove();
                                    updatePlanSummary();
                                });
                                
                                finalPlanItems.appendChild(planItem);
                            }
                        }
                        
                        updatePlanSummary();
                        
                        // Handle apply edits button
                        document.getElementById('draft-apply-edits').addEventListener('click', function() {
                            const editedPlan = document.getElementById('draft-edit-textarea').value;
                            alert('Edits applied! In a real study, these edits would update your plan.');
                        });
                        break;
                }
            }
            
            // Set up household profile selection
            const profileSelect = document.getElementById('household-profile');
            profileSelect.addEventListener('change', function() {
                const profileId = this.value;
                updateProfileDisplay(profileId);
                updateAvailableActions(profileId);
                
                // Update the planning interface if support level is already selected
                const supportLevel = document.querySelector('input[name="support-level"]:checked').value;
                updatePlanningInterface(supportLevel, profileId);
            });
            
            // Set up action category filter
            const categoryFilter = document.getElementById('action-category-filter');
            categoryFilter.addEventListener('change', function() {
                const category = this.value;
                const profileId = profileSelect.value;
                updateAvailableActions(profileId, category);
            });
            
            // Set up support level selection
            const supportLevels = document.querySelectorAll('input[name="support-level"]');
            supportLevels.forEach(level => {
                level.addEventListener('change', function() {
                    const supportLevel = this.value;
                    const profileId = profileSelect.value;
                    updatePlanningInterface(supportLevel, profileId);
                });
            });
            
            // Initialize with default values
            updateProfileDisplay(1);
            updateAvailableActions(1);
            updatePlanningInterface('control', 1);
        }

        // Initialize Background tabs
        function initializeBackgroundTabs() {
            // Populate household profiles
            const profilesContainer = document.getElementById('profiles-container');
            
            profilesContainer.innerHTML = householdProfiles.map(profile => `
                <div class="card profile-card mb-20">
                    <h3>${profile.name}</h3>
                    <p class="profile-description">${profile.description}</p>
                    
                    <div class="profile-details">
                        <div class="profile-stat">
                            <span>Annual Electricity Use:</span>
                            <strong>${profile.annualUsage} kWh</strong>
                        </div>
                        <div class="profile-stat">
                            <span>Average Monthly Bill:</span>
                            <strong>$${profile.monthlyCost}</strong>
                        </div>
                        <div class="profile-stat">
                            <span>10% Reduction Target:</span>
                            <strong>${Math.round(profile.annualUsage * 0.1)} kWh</strong>
                        </div>
                    </div>
                    
                    <h4>Energy Breakdown</h4>
                    <div class="energy-breakdown-chart">
                        <div class="breakdown-bar">
                            <div class="breakdown-segment heating-cooling" style="width: ${profile.breakdown.heatingCooling}%;" title="Heating/Cooling: ${profile.breakdown.heatingCooling}%"></div>
                            <div class="breakdown-segment water-heating" style="width: ${profile.breakdown.waterHeating}%;" title="Water Heating: ${profile.breakdown.waterHeating}%"></div>
                            <div class="breakdown-segment lighting" style="width: ${profile.breakdown.lighting}%;" title="Lighting: ${profile.breakdown.lighting}%"></div>
                            <div class="breakdown-segment refrigeration" style="width: ${profile.breakdown.refrigeration}%;" title="Refrigeration: ${profile.breakdown.refrigeration}%"></div>
                            <div class="breakdown-segment electronics-appliances" style="width: ${profile.breakdown.electronicsAppliances}%;" title="Electronics/Appliances: ${profile.breakdown.electronicsAppliances}%"></div>
                        </div>
                        <div class="breakdown-legend">
                            <div class="legend-item">
                                <div class="legend-color heating-cooling"></div>
                                <span>Heating/Cooling: ${profile.breakdown.heatingCooling}%</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color water-heating"></div>
                                <span>Water Heating: ${profile.breakdown.waterHeating}%</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color lighting"></div>
                                <span>Lighting: ${profile.breakdown.lighting}%</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color refrigeration"></div>
                                <span>Refrigeration: ${profile.breakdown.refrigeration}%</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color electronics-appliances"></div>
                                <span>Electronics/Appliances: ${profile.breakdown.electronicsAppliances}%</span>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Populate energy actions table
            const actionsTableBody = document.getElementById('actions-table-body');
            
            actionsTableBody.innerHTML = energyActions.map(action => `
                <tr data-category="${action.category}">
                    <td>${action.action}<br><small>${action.assumptions}</small></td>
                    <td>${action.category}</td>
                    <td>${action.savingsKWh}</td>
                    <td>${action.savingsPercent[1].toFixed(2)}%</td>
                    <td>${action.difficulty}</td>
                    <td>${action.upfrontCost}</td>
                </tr>
            `).join('');
            
            // Actions table filtering and sorting
            const searchInput = document.getElementById('actions-search');
            const categoryFilter = document.getElementById('actions-category');
            const sortControl = document.getElementById('actions-sort');
            
            function updateActionsTable() {
                const searchTerm = searchInput.value.toLowerCase();
                const categoryValue = categoryFilter.value;
                const sortValue = sortControl.value;
                
                const rows = document.querySelectorAll('#actions-table tbody tr');
                
                // Filter rows
                rows.forEach(row => {
                    const action = row.cells[0].textContent.toLowerCase();
                    const category = row.getAttribute('data-category');
                    
                    const matchesSearch = !searchTerm || action.includes(searchTerm);
                    const matchesCategory = categoryValue === 'all' || category === categoryValue;
                    
                    row.style.display = matchesSearch && matchesCategory ? '' : 'none';
                });
                
                // Sort rows
                const visibleRows = Array.from(rows).filter(row => row.style.display !== 'none');
                
                visibleRows.sort((a, b) => {
                    if (sortValue === 'savings') {
                        return parseInt(b.cells[2].textContent) - parseInt(a.cells[2].textContent);
                    } else if (sortValue === 'category') {
                        return a.cells[1].textContent.localeCompare(b.cells[1].textContent);
                    } else if (sortValue === 'difficulty') {
                        const difficultyOrder = { 'Easy': 1, 'Medium': 2, 'Hard': 3 };
                        return difficultyOrder[a.cells[4].textContent] - difficultyOrder[b.cells[4].textContent];
                    } else if (sortValue === 'cost') {
                        const costOrder = { 'None': 1, 'Low': 2, 'Medium': 3, 'High': 4 };
                        const aCost = a.cells[5].textContent.startsWith('None') ? 'None' :
                                    a.cells[5].textContent.startsWith('Low') ? 'Low' :
                                    a.cells[5].textContent.startsWith('Medium') ? 'Medium' : 'High';
                        const bCost = b.cells[5].textContent.startsWith('None') ? 'None' :
                                    b.cells[5].textContent.startsWith('Low') ? 'Low' :
                                    b.cells[5].textContent.startsWith('Medium') ? 'Medium' : 'High';
                        return costOrder[aCost] - costOrder[bCost];
                    }
                });
                
                // Reorder the DOM
                const tbody = document.querySelector('#actions-table tbody');
                visibleRows.forEach(row => tbody.appendChild(row));
            }
            
            searchInput.addEventListener('input', updateActionsTable);
            categoryFilter.addEventListener('change', updateActionsTable);
            sortControl.addEventListener('change', updateActionsTable);
            
            // Initial sort
            updateActionsTable();
        }
    </script>


</body></html>